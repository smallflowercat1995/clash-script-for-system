(t=>{function e(e){for(var a,r,l=e[0],o=e[1],c=e[2],h=0,u=[];h<l.length;h++)r=l[h],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);for(d&&d(e);u.length;)u.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,l=1;l<s.length;l++){var o=s[l];0!==i[o]&&(a=!1)}a&&(n.splice(e--,1),t=r(r.s=s[0]))}return t}var a={},i={5:0},n=[];function r(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=a,r.d=(t,e,s)=>{r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=(t,e)=>{if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(s,a,(e=>t[e]).bind(null,a));return s},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,"a",e),e},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.p="/";var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var d=o;n.push([190,1,2,0]),s()})({186:(t,e,s)=>{"use strict";var a=s(59);s.n(a).a},187:(t,e,s)=>{},190:function(t,e,s){"use strict";s.r(e);var a=s(28),i=s(0),n=(s(34),s(7)),r=(s(67),s(65),s(20)),l=s.n(r),o=s(21),c=s(32),d=s(2),h=s(37),u=s(27),p=s(35),f=s(1),m=s(25),g=s(8);const b=Object(c.a)({});let w,v,C;var y={components:{Icon:o.a,VmCode:h.default,SettingCheck:u.a,Tooltip:l.a},data(){return{installable:!1,installed:!1,dependencyOK:!1,closeAfterInstall:n.a.get("closeAfterInstall"),message:"",code:"",commands:{close:this.close},info:{},decodedUrl:"...",descr:"",error:null,heading:this.i18n("msgLoadingData"),lists:null,listsShown:!0,name:"...",safeIcon:null,urlsOK:{}}},computed:{trackTooltip(){return g.a.isFirefox>=68?this.i18n("installOptionTrackTooltip"):null},isLocal(){return!Object(i.q)(this.info.url)}},async mounted(){const t=`confirm-${m.c.paths[0]}`;if(this.info=await Object(i.w)("CacheLoad",t),!this.info)return void this.close();const{url:e}=this.info;if(this.decodedUrl=decodeURIComponent(e),C=g.a.isFirefox>=68&&e.startsWith("file:"),this.guard=setInterval(i.w,5e3,"CacheHit",{key:t}),await this.loadData(),!await this.parseMeta()){let t=2;do{await Object(i.s)(3e3)}while(!await this.loadDeps()&&(t-=1))}this.installable&&(this.heading=this.i18n("labelInstall"))},beforeDestroy(){this.guard&&(clearInterval(this.guard),this.guard=null)},methods:{async loadData(t){this.installable=!1;const e=C?await new Promise(this.pingFilePort):await this.getScript(this.info.url);if(null==e||t&&this.code===e)throw 0;this.code=e},async parseMeta(){var t;const e=await Object(i.w)("ParseMeta",this.code),s=Object.values(e.resources);return this.name=(t=[Object(i.k)(e,"name"),e.version],i.z).call(t,", "),this.descr=Object(i.k)(e,"description"),this.lists=Object(f.i)(e,["antifeature","grant","match","include","exclude","excludeMatch","compatible","connect"],t=>(null==t?void 0:t.map(t=>[t.replace(/^\W+/,"")||t,t]).sort(([t],[e])=>t<e?-1:t>e).map(([,t])=>t).join("\n"))||""),this.lists.require=[...new Set(e.require)],this.lists.resource=[...new Set(s)],this.meta=e,this.loadDeps()},async loadDeps(){var t;this.safeIcon||Object(p.a)(this);const{require:e,resource:s}=this.lists;this.require={},this.resources={};const a=e.length+s.length;let n=0;const r=performance.now(),l=()=>{performance.now()-r>500&&(this.message=this.i18n("msgLoadingDependency",[n,a]))},o=async(t,e,s)=>{const a=Object(i.j)(t,this.info.url);try{e[a]=await this.getFile(a,{isBlob:s,useCache:!0}),this.urlsOK[t]=!0,n+=1,l()}catch(e){return t}},c=setTimeout(l,500),d=[...e.map(t=>o(t,this.require,!1)),...s.map(t=>o(t,this.resources,!0))],h=(t=await Promise.all(d),i.z).call(t,"\n");if(clearTimeout(c),!h)return this.error=null,this.dependencyOK=!0,this.installable=!0,this.message=null,!0;this.message=this.i18n("msgErrorLoadingDependency"),this.error=h},close(){Object(i.w)("TabClose")},async getFile(t,{isBlob:e,useCache:s}={}){const a=e?`blob+${t}`:`text+${t}`;if(s&&b.has(a))return b.get(a);const n=await Object(i.v)(t,{responseType:e?"arraybuffer":null}),r=e?d.a.cache.makeRaw(n):n.data;return s&&b.put(a,r),r},async getScript(t){try{return await Object(i.w)("CacheLoad",t)||await this.getFile(t)}catch(e){throw this.message=this.i18n("msgErrorLoadingData"),t}},getTimeString(){const t=new Date;return`${Object(i.r)(t.getHours(),2)}:${Object(i.r)(t.getMinutes(),2)}:${Object(i.r)(t.getSeconds(),2)}`},installScript(){return this.installable=!1,Object(i.w)("ParseScript",{code:this.code,url:this.info.url,from:this.info.from,require:this.require,cache:this.resources}).then(t=>{this.message=`${t.update.message}[${this.getTimeString()}]`,this.closeAfterInstall?this.close():(this.installed=!0,this.trackLocalFile())},t=>{this.message=`${t}`,this.installable=!0})},async trackLocalFile(){if(!this.tracking&&this.isLocal&&this.installed){for(this.tracking=!0;n.a.get("trackLocalFile")&&"stop"!==this.tracking;){await Object(i.s)(500);try{await this.loadData(!0),await this.parseMeta(),await this.installScript()}catch(t){}}this.tracking=!1}},checkClose(t){this.closeAfterInstall=t,t&&n.a.set("trackLocalFile",!1)},createFilePort(){w=browser.tabs.connect(this.info.tabId,{name:"FetchSelf"}),w.onMessage.addListener(t=>{v(t)}),w.onDisconnect.addListener(()=>{this.tracking="stop"})},pingFilePort(t){w||this.createFilePort(),v=t,w.postMessage(null)}}},O=(s(186),s(5)),k=Object(O.a)(y,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-confirm frame flex flex-col h-100"},[s("div",{staticClass:"frame-block"},[s("div",{staticClass:"flex"},[t._m(0),s("div",{staticClass:"info"},[s("h1",[s("div",{domProps:{textContent:t._s(t.heading)}}),s("div",{staticClass:"ellipsis",domProps:{textContent:t._s(t.name)}})]),s("a",{staticClass:"url ellipsis",attrs:{title:t.info.url,href:t.info.url},domProps:{textContent:t._s(t.decodedUrl)},on:{click:t=>{t.preventDefault()}}}),s("p",{staticClass:"descr",domProps:{textContent:t._s(t.descr)}}),s("div",{staticClass:"lists flex flex-wrap",attrs:{"data-collapsed":!t.listsShown}},[t.lists?s("tooltip",{attrs:{content:t.i18n("msgShowHide"),placement:"top"}},[s("div",{staticClass:"toggle",on:{click:e=>{t.listsShown=!t.listsShown}}},[s("icon",{attrs:{name:"info"}})],1)]):t._e(),t._l(t.lists,(e,a)=>s("dl",{key:a,attrs:{"data-type":a,hidden:!e.length,tabindex:"0"}},[s("dt",{domProps:{textContent:t._s("@"+a)}}),Array.isArray(e)?s("dd",{staticClass:"flex flex-col"},t._l(e,(e,i)=>s("a",{key:a+i,attrs:{href:e,rel:"noopener noreferrer",target:"_blank","data-ok":e in t.urlsOK},domProps:{textContent:t._s(e)}})),0):s("dd",{staticClass:"ellipsis",domProps:{textContent:t._s(e)}})]))],2),s("div",{attrs:{title:t.error},domProps:{textContent:t._s(t.message)}})])]),s("div",{staticClass:"flex"},[s("div",{staticClass:"image flex"},[s("img",{attrs:{src:t.safeIcon}})]),s("div",{staticClass:"actions flex flex-wrap mr-2c"},[s("button",{attrs:{disabled:!t.installable},domProps:{textContent:t._s(t.i18n("buttonConfirmInstallation"))},on:{click:t.installScript}}),s("button",{domProps:{textContent:t._s(t.i18n("buttonClose"))},on:{click:t.close}}),s("setting-check",{attrs:{name:"closeAfterInstall",label:t.i18n("installOptionClose")},on:{change:t.checkClose}}),s("setting-check",{attrs:{name:"trackLocalFile",disabled:t.closeAfterInstall||!t.isLocal},on:{change:t.trackLocalFile}},[s("tooltip",{attrs:{content:t.trackTooltip,disabled:!t.trackTooltip}},[s("span",{domProps:{textContent:t._s(t.i18n("installOptionTrack"))}})])],1)],1)]),t.info.incognito?s("div",{staticClass:"incognito",domProps:{textContent:t._s(t.i18n("msgIncognitoChanges"))}}):t._e()]),s("div",{staticClass:"frame-block flex-auto pos-rel"},[s("vm-code",{staticClass:"abs-full",attrs:{readonly:"",value:t.code,commands:t.commands}})],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"image"},[e("img",{attrs:{src:"/public/images/icon128.png"}})])}],!1,null,null,null).exports;s(187),a.default.prototype.i18n=i.n,document.title=`${Object(i.n)("labelInstall")} - ${Object(i.n)("extName")}`,n.a.ready.then(()=>{const t=document.createElement("div");document.body.appendChild(t),new a.default({render:t=>t(k)}).$mount(t)})},59:(t,e,s)=>{}});