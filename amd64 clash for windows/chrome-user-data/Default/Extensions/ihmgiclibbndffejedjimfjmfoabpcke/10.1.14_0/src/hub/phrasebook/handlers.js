!function(e){var t=null;pl.extend(ke.app.handlers,{_processEventHandlers:{app:{audio:{}}},addWordlist:function(){var e=ke.app.$new_wordlist_name.val(),t=ke.ui.dropdown.getActiveOptionValue(1),a=ke.ui.dropdown.getActiveOptionValue(2);if(!(pl.empty(e)||pl.empty(t)||pl.empty(a))){var o=Date.now();ke.idb.add("it","wordlists",{from:t,to:a,name:e,last_update:o,created:o,phrases_count:0,server_id:null,pending_removal:!1},"wordlist",(function(n,s){var r=0;ke.app.temp.word_pending_adding&&(chrome.runtime.sendMessage({action:ke.processCall("app","phrasebook","addPhrase"),wl_id:n,phrase:ke.app.temp.word_pending_adding,from:ke.app.temp.current_wordlist_from_lang,to:ke.app.temp.current_wordlist_to_lang},(function(e){ke.app.temp.word_pending_adding=""})),++r),ke.app.render.organize.drawWordlist({id:n,from:t,to:a,name:e,last_update:o,phrases_count:r},undefined,!0),$(".wl-"+n).click(),ke.app.$new_wordlist_name.val(""),ke.app.handlers.onWordlistAddClose(),ke.app.handlers.toggleEmptyWordlistsCap(),chrome.runtime.sendMessage({action:ke.processCall("app","sync","uploadWordlist"),id:n,wordlist:s},(function(){})),"undefined"!=typeof ga&&ga("send","event","pb","wl-create")}))}},addPhrase:function(){var e=ke.app.$add_phrase_input.val();pl.empty(e)||(navigator.onLine?(ke.app.$add_phrase_button.hide(),ke.app.$add_phrase_loading.show(),chrome.runtime.sendMessage({action:ke.processCall("app","phrasebook","addPhrase"),wl_id:ke.app.temp.current_wordlist_id,phrase:e,from:ke.app.temp.current_wordlist_from_lang,to:ke.app.temp.current_wordlist_to_lang},(function(e){if(e.no_results)return alert(ke.getLocale("Kernel_NoResults")),ke.app.$add_phrase_loading.hide(),void ke.app.$add_phrase_button.show();ke.app.render.organize.drawPhrase(e,"prepend"),ke.app.$add_phrase_loading.hide(),ke.app.$add_phrase_button.show(),ke.app.$add_phrase_input.val(""),ke.app.handlers.toggleEmptyPhrasesCap(),"undefined"!=typeof ga&&ga("send","event","pb","phrase-add")}))):alert(ke.getLocale("Pb_NoInternet")))},onEnterAddPhrase:function(e){13===e.keyCode&&ke.ext.event.isDown("enter",ke.ext.event.IN_STR)&&ke.app.handlers.addPhrase()},onWordlistAddLangDropdownOpen:function(e,t){ke.is_touch_device()||(ke.particles.scrollbars.model.setupFromWindowDropdownScroll(t),ke.particles.scrollbars.model.setupToWindowDropdownScroll(t))},onWordlistAddLangDropdownChange:function(e,t,a,o){1===e?ke.app.temp.new_wordlist_from_lang=t:2===e&&(ke.app.temp.new_wordlist_to_lang=t),ke.app.initDropdown()},onWordlistAddLangSwap:function(){var e=ke.ui.dropdown.getActiveOptionValue(1),t=ke.ui.dropdown.getActiveOptionValue(2);ke.ui.dropdown.data.callback(1,t,null,!0),ke.ui.dropdown.data.callback(2,e,null,!1),ke.app.initDropdown()},onWordlistAdd:function(e){var t=$(".wordlist").length;!ke.isProUser&&t>=1?ke.ui.pro_alert.show(ke.getLocale("Pro_PhrasebookFeature"),"phrasebook"):($(".new-wordlist-layout").fadeIn(250).css("display","flex"),"undefined"!=typeof ga&&ga("send","event","pb","new-wl-popup-show"))},onWordlistAddOuterClose:function(e){$(e.target).hasClass("popup-layout")&&(ke.app.handlers.onWordlistAddClose(),ke.app.handlers.onUpgradeClose())},onWordlistAddClose:function(){$(".new-wordlist-layout").hide()},onUpgradeClose:function(){$(".upgrade-layout").hide(),"undefined"!=typeof ga&&ga("send","event","pb","upgrade-close")},onWordlistOpen:function(e){var t=$(this).attr("id");ke.ui.loading.show((function(){document.location.hash="wl-"+t}))},onWordlistQuit:function(e){ke.app.view_mode===ke.app.VM_ITEM?(ke.app.view_mode=ke.app.VM_WORDLIST,$("body").removeClass("phrase-view-mode"),$("body").addClass("wl-view-mode"),$(".expanded").hide(),$(".phrases").show()):document.location.hash="",$(".search-input").val("")},onWordlistDelete:function(e){e.stopPropagation();var t=+$(this).attr("id"),a=this;confirm(ke.getLocale("Pb_SureToDeleteWordlist"))&&ke.ext.util.storageUtil.requestBackgroundOption("getVal",["account_token"],(function(e){e?ke.idb.update("it","wordlists",t,{pending_removal:!0},(function(e,t){ke.idb.findAndUpdate("it","phrases",{parent_wordlist_key:t},{pending_removal:!0},(function(o){$(a).parent().remove(),--ke.app.temp.wl_amount,ke.app.handlers.toggleEmptyWordlistsCap(),chrome.runtime.sendMessage({action:ke.processCall("app","sync","deleteWordlist"),r_wl:!0,wl_id:t,wl_server_id:e.server_id,words:o}),"undefined"!=typeof ga&&ga("send","event","pb","wl-delete")}))})):ke.idb.del("it","wordlists",[t],(function(e){ke.idb.findAndDel("it","phrases",{parent_wordlist_key:t},(function(){$(a).parent().remove(),--ke.app.temp.wl_amount,ke.app.handlers.toggleEmptyWordlistsCap(),"undefined"!=typeof ga&&ga("send","event","pb","wl-delete")}))}))}))},onPhrasePreview:function(e){ke.app.view_mode=ke.app.VM_ITEM,$("body").removeClass("wl-view-mode"),$("body").addClass("phrase-view-mode"),$(".phrases").hide(),$(".expanded").html($(this).html()).show();var t=ke.app.temp.current_wordlist_from_lang,a=ke.app.temp.current_wordlist_to_lang,o=$(".expanded");ke.particles.listen.model.ctrlHistoryOrigVisibility(null,t,o),ke.particles.listen.model.ctrlHistoryTransVisibility(null,a,o),ke.particles.listen.model.ctrlSynonymVis(null,a,o),$(".expanded").find(".listen-selector, .listen-v-item").on("click",ke.app.handlers.onPhrasePlayback),$(".expanded").find(".copy-button").on("click",ke.particles.three_dots.model.copyMain),$(".expanded").find(".small-copy-button").on("click",ke.particles.three_dots.model.copySynonym),"undefined"!=typeof ga&&ga("send","event","pb","phrase-preview")},onPhraseDelete:function(e){e.stopPropagation();var t=+$(this).attr("id"),a=+$(this).attr("pid"),o=this;ke.ext.util.storageUtil.requestBackgroundOption("getVal",["account_token"],(function(e){e?ke.idb.update("it","phrases",t,{pending_removal:!0},(function(e,t){ke.idb.update("it","wordlists",a,{last_update:Date.now(),phrases_count:{update_type:ke.idb.ARITH_ADD_UPDATE_TYPE,value:-1}},(function(t){$(o).parent().remove(),--ke.app.temp.phrases_amount,ke.app.handlers.toggleEmptyPhrasesCap(),chrome.runtime.sendMessage({action:ke.processCall("app","sync","deleteWordlist"),r_wl:!1,wl_id:a,wl_server_id:t.server_id,words:[e]}),"undefined"!=typeof ga&&ga("send","event","pb","phrase-delete")}))})):ke.idb.del("it","phrases",[t],(function(e,t){ke.idb.update("it","wordlists",a,{last_update:Date.now(),phrases_count:{update_type:ke.idb.ARITH_ADD_UPDATE_TYPE,value:-1}},(function(){$(o).parent().remove(),--ke.app.temp.phrases_amount,ke.app.handlers.toggleEmptyPhrasesCap(),"undefined"!=typeof ga&&ga("send","event","pb","phrase-delete")}))}))}))},getPlaybackContents:function(e,t){t=t||$(".expanded");return"orig"===e?t.find(".p-orig").html():"trans"===e?t.find(".p-trans").html():"synonym"===e?t.find(".main-of-item").html():""},onPhrasePlayback:function(e){e.stopPropagation();var t,a=$(this).hasClass("listen-original"),o=$(this).hasClass("listen-v-item");t=o?ke.app.handlers.getPlaybackContents("synonym",$(this).parent()):a?ke.app.handlers.getPlaybackContents("orig"):ke.app.handlers.getPlaybackContents("trans");var n=$(this).parent().parent();o?ke.particles.listen.model.playPhrasebookSynonym.call($(this),t,ke.app.temp.current_wordlist_to_lang,n):a?ke.particles.listen.model.playPhrasebookOriginal.call($(this),t,ke.app.temp.current_wordlist_from_lang,n):ke.particles.listen.model.playPhrasebookTrans.call($(this),t,ke.app.temp.current_wordlist_to_lang,n),"undefined"!=typeof ga&&ga("send","event","pb","tts")},onHashChange:function(e){pl.empty(document.location.hash)||document.location.hash.indexOf("wl_create")>-1?(ke.app.view_mode=ke.app.VM_WORDLISTS,$("body").removeClass("wl-view-mode"),$(".search").hide(),ke.app.$phrases.html("").hide(),ke.app.$wordlists.html("").show(),ke.app.$add_wordlist_button.show(),ke.app.$quit_wordlist_button.hide(),ke.app.$add_phrase_layout.hide(),ke.app.$page_name.html(ke.getLocale("Kernel_PhrasebookTitle")),$(".export-button").hide(),$(".right-action-buttons .sync-button").hide(),$(".left-action-buttons").show(),$(".learn-button").hide()):(ke.app.view_mode=ke.app.VM_WORDLIST,$("body").addClass("wl-view-mode"),ke.app.temp.phrases_amount>0&&($(".search").css("display","inline-block"),ke.ext.util.storageUtil.requestBackgroundOption("isTrueOption",["sync"],(function(e){e&&$(".search").addClass("search-shifted-left")}))),ke.app.$wordlists.html("").hide(),ke.app.$phrases.html("").show(),ke.app.$add_phrase_input.val(""),ke.app.$add_wordlist_button.hide(),ke.app.$quit_wordlist_button.show(),ke.app.$add_phrase_layout.show(),$(".export-button").show(),$(".right-action-buttons .sync-button").show(),$(".left-action-buttons").hide(),$(".learn-button").show()),ke.app.render.organize.tryShowingWordlist()},toggleEmptyWordlistsCap:function(e){0===ke.app.temp.wl_amount?($(".content-wrap").hide(),e?(ke.app.$ec_wrap.addClass("w-search-layout").show().find(".ec-text").html(ke.getLocale("CommonUi_NoResults")),ke.app.$ec_wrap.find(".empty-phrasebook,.empty-wordlist").hide()):($(".search-layout").hide(),ke.app.$ec_wrap.find(".empty-phrasebook,.empty-wordlist").hide(),ke.app.$ec_wrap.removeClass("w-search-layout").show().find(".ec-inside-layout").hide(),ke.app.$ec_wrap.find(".empty-phrasebook").show())):($(".content-wrap").show(),$(".search-layout").show(),ke.app.$ec_wrap.hide())},toggleEmptyPhrasesCap:function(e){0===ke.app.temp.phrases_amount?e?($(".export-button").hide(),$(".content-wrap").hide(),ke.app.$ec_wrap.addClass("w-search-layout").show().find(".ec-text").html(ke.getLocale("CommonUi_NoResults")),ke.app.$ec_wrap.find(".empty-phrasebook,.empty-wordlist").hide()):($(".add-phrase-layout").show(),$(".export-button").hide(),$(".search-layout").hide(),$(".search").hide(),$(".content-wrap").hide(),ke.app.$ec_wrap.find(".empty-phrasebook,.empty-wordlist").hide(),ke.app.$ec_wrap.removeClass("w-search-layout").show().find(".ec-inside-layout").hide(),ke.app.$ec_wrap.find(".empty-wordlist").show(),$(".learn-button").hide()):(ke.app.flags.is_searching?($(".add-phrase-layout").hide(),$(".search").hide(),$(".search-layout").show(),$(".export-button").hide()):($(".search-layout").hide(),$(".search").show(),$(".add-phrase-layout").show(),$(".export-button").show(),$(".learn-button").show()),$(".content-wrap").show(),ke.app.$ec_wrap.hide())},toggleSearchMode:function(){ke.app.view_mode===ke.app.VM_WORDLIST&&(ke.app.flags.is_searching?(ke.app.flags.is_searching=!1,$(".right-action-buttons .sync-button").show(),$(".export-button").show(),$(".search-layout").hide(),$(".search").show(),$(".add-phrase-layout").show(),$(".learn-button").show()):(ke.app.flags.is_searching=!0,$(".right-action-buttons .sync-button").hide(),$(".export-button").hide(),$(".add-phrase-layout").hide(),$(".search").hide(),$(".search-layout").show(),$(".learn-button").hide()))},clearSearch:function(){$(".search-input").val(""),ke.app.handlers.search(null,"")},search:function(e,a){var o=pl.type(a,"undef")?$(this).val():a;pl.empty(o)?$(".clear-input-tick").hide():$(".clear-input-tick").show(),null!==t&&clearTimeout(t),t=setTimeout((function(){t=null,ke.app.view_mode===ke.app.VM_WORDLISTS?($(".wordlists").html(""),ke.app.render.organize.populateWordlists((function(){}),o)):ke.app.view_mode===ke.app.VM_WORDLIST&&($(".phrases").html(""),ke.app.render.organize.populatePhrases(ke.app.temp.current_wordlist_id,o,(function(){})))}),750)},sync:function(){ke.particles.sync.ui_model.sendSyncRequest("syncPhrasebook",(function(e,t){e&&t&&(ke.ui.loading.show(),setTimeout((function(){ke.app.handlers.onHashChange()}),250))}),ke.getLocale("Pro_SyncFeature"),$(".sync-button"))},downloadWordlistAsCSV:function(){var e=$(this);ke.isProUser?("undefined"!=typeof ga&&ga("send","event","pb","export-wordlist"),e.addClass("downloading"),ke.idb.search("it","phrases",(function(e){return!e.pending_removal&&e.parent_wordlist_key===ke.app.temp.current_wordlist_id}),(function(t){var a=[[ke.getLocale("Csv_TimeDate"),ke.getLocale("Csv_Input"),ke.getLocale("Csv_Translation"),ke.getLocale("Csv_Transliteration"),ke.getLocale("Csv_Synonyms")]];t.forEach((function(e){var t=[];e.json[7].forEach((function(e){e.forEach((function(e){t.push(e[0])}))})),a.push(['"'+ke.ext.time.beautify(e.added)+'"','"'+e.text+'"','"'+e.translation+'"','"'+e.json[4]+'"','"'+t.join(", ")+'"'])})),ke.ext.file.downloadAsCSV(a,(function(){e.removeClass("downloading")}))}))):ke.ui.pro_alert.show(ke.getLocale("Pro_ExportFeature"),"wordlist-export")},subscribeForReji:function(e){var t=$("."+e+"-email").val();ke.ext.string.isValidEmail(t)?$.ajax({url:"https://reji.me/api/android_subscribe",type:"GET",dataType:"json",data:{email:t,platform:"android"===e?e:ke.PLATFORM_CODE,deck_url_id:ke.app.temp.shared_list_id},success:function(t){t.success&&(alert("It's all set! We'll notify you when Reji comes out!"),$(".share-wordlist").fadeOut(250),"undefined"!=typeof ga&&ga("send","event","pb","subscribe-reji",e))}}):alert("Doesn't look like a valid email!")},showAndroidForm:function(){$(".ios-contents").slideUp(250,(function(){$(".android-contents").slideDown(250)})),$(".request-android").on("click",(function(){ke.app.handlers.subscribeForReji("android")}))},showChromeForm:function(){$(".ios-contents").slideUp(250,(function(){$(".android-contents").slideDown(250)})),$(".request-chrome").on("click",(function(){ke.app.handlers.subscribeForReji("chrome")}))},learnWordlist:function(){$(this).hasClass("share-loading")||($(".select-learn-langs-layout").css("display","flex").fadeIn(250),$(".learn-from-lang").html(ke.getLocale("Kernel_Lang_"+ke.ext.util.langUtil.getLangNameByKey(ke.app.temp.current_wordlist_from_lang))).on("click",(function(){ke.app.handlers.learnWordlistFor("from")})),$(".learn-to-lang").html(ke.getLocale("Kernel_Lang_"+ke.ext.util.langUtil.getLangNameByKey(ke.app.temp.current_wordlist_to_lang))).on("click",(function(){ke.app.handlers.learnWordlistFor("to")})),$(".learn-cancel").on("click",(function(){$(".select-learn-langs-layout").fadeOut(250)})))},learnWordlistFor:function(e){$(".select-learn-langs-layout").fadeOut(250),$(this).addClass("share-loading").html(ke.getLocale("Pb_Loading")),ke.ext.util.storageUtil.isTrueOption("learn_onboarding")?($(".onboarding-contents").hide(),$(".android-contents").hide(),$(".chrome-contents").hide(),$(".ios-contents").show()):($(".onboarding-contents").show(),$(".ios-contents").hide(),$(".proceed-learn-onboarding").on("click",(function(){$(".onboarding-contents").slideUp(250,(function(){$(".ios-contents").slideDown(250)}))})),ke.ext.util.storageUtil.setVal("learn_onboarding",!0)),$(".share-close").on("click",(function(){$(".share-wordlist").fadeOut(250)}));var t=$(this);ke.idb.search("it","phrases",(function(e){return!e.pending_removal&&e.parent_wordlist_key===ke.app.temp.current_wordlist_id}),(function(a){var o=[];a.forEach((function(t){var a=t.usageExample?"\n"+t.usageExample:"",n=t.text,s=t.translation;if("to"===e){var r=n;n=s,s=r}o.push(n+"\n"+s+a)}));var n=ke.app.temp.current_wordlist_from_lang,s=ke.app.temp.current_wordlist_to_lang;if("to"===e){var r=s;s=n,n=r}console.log(o.join("\n\n")),$.ajax({url:"https://reji.me/api/share_deck_raw",type:"POST",processData:!1,contentType:"application/json",data:JSON.stringify({name:ke.app.$page_name.html(),type:"translation",from:n,to:s,raw_data:o.join("\n\n")}),success:function(e){if(e.short_link){ke.app.temp.shared_list_id=e.url_id,"undefined"!=typeof ga&&ga("send","event","pb","export-reji","success");var a="rgba(0, 0, 0, 1.0)";$("body").hasClass("dark-mode")&&(a="#000"),$(".qr-code").html(""),$(".deck-link").attr("href",e.short_link).html(e.short_link),new QRCode($(".qr-code")[0],{text:e.firebase_link,width:192,height:192,colorDark:a,colorLight:"rgba(0, 0, 0, 0.0)",correctLevel:QRCode.CorrectLevel.H}),$(".share-wordlist").fadeIn(250).css("display","flex"),t.removeClass("share-loading").html(ke.getLocale("Pb_Learn"))}else t.removeClass("share-loading"),alert("Some error occurred... Please try again or contact us at support@matetranslate.com.")},error:function(){t.removeClass("share-loading").html("learn"),alert("Some error occurred... Please try again or contact us at support@matetranslate.com."),"undefined"!=typeof ga&&ga("send","event","pb","export-reji","failed")}})}))}})}();