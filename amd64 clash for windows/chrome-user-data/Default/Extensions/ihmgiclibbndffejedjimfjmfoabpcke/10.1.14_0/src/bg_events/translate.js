pl.extend(ke.app.handlers._processEventHandlers.app.translate,{get:function(e,t){var n=e.from||ke.ext.util.langUtil.getFromLang(),i=e.to||ke.ext.util.langUtil.getToLang(),o=t;e.text=ke.ext.string.escapeHtml(e.text);var a="window"===e.identificator?{translation:ke.getLocale("Kernel_Listen")}:null;"undefined"!=typeof ga&&ga("send","event","translation",e.identificator,e.type),"undefined"!=typeof ga&&ga("send","event","translation-by-country",ke.ext.util.storageUtil.getVal("user_country")),"undefined"!=typeof ga&&("cn"==ke.ext.util.storageUtil.getVal("user_country")||navigator.language.indexOf("zh")>-1)&&ga("send","event","translation-country","china (locale or ip)"),Date.now()-ke.ext.util.storageUtil.getIntValue("last_trans_count_upd")>=ke.TIME.ONE_DAY&&ke.app.handlers.sendTranslationsCount(),"tooltip"===e.identificator?(ke.ext.util.storageUtil.setJsonField("translations_count",e.type,+ke.ext.util.storageUtil.getJsonField("translations_count",e.type)+1),ke.ext.util.storageUtil.setJsonField("all_trans_count",e.type,+ke.ext.util.storageUtil.getJsonField("all_trans_count",e.type)+1)):(ke.ext.util.storageUtil.setJsonField("translations_count",e.identificator,+ke.ext.util.storageUtil.getJsonField("translations_count",e.identificator)+1),ke.ext.util.storageUtil.setJsonField("all_trans_count",e.identificator,+ke.ext.util.storageUtil.getJsonField("all_trans_count",e.identificator)+1)),ke.app.handlers._processEventHandlers.app.opt.updateUninstallUri(),ke.ext.googleApi.getTextTranslation(n,i,e.text,(function(t){if(t.error)ke.ext.cache.lookUpInCache(n,i,e.text,(function(t,l){if(t)o({offline:!0});else{var r=l.it_resp,s=ke.ext.googleApi.parseReceivedTranslation(r,!1,e.prefix,a,!0);s[6]=i,o({code:s[1],trans_translit:[ke.ext.util.storageUtil.isTrueOption("show_translit"),r[4]],trans_ipa:[ke.ext.util.storageUtil.isTrueOption("show_ipa"),r[2]],isMulti:r[0],detected_lang:r[5],from:n,to:i,json:r})}}));else{var l=function(l,r){if(l[3]){var s=t.spell&&t.spell.spell_res,g=ke.ext.googleApi.parseReceivedTranslation(l,!1,e.prefix,a,!0),u=function(){let t="auto"===n?l[5]:n,a=i;"undefined"!=typeof ga&&ga("send","event","translation-by-lang-pairs",t+" <-> "+a);let u=ke.ext.util.storageUtil.getDecodedVal("char_stats");u.total+=e.text.length,++u.translations,u.chars_per_pair[t+"-"+a]||(u.chars_per_pair[t+"-"+a]=0),u.chars_per_pair[t+"-"+a]+=e.text.length,ke.ext.util.storageUtil.encodeAndSet("char_stats",u),o({code:g[1],isMulti:l[0],trans_translit:[ke.ext.util.storageUtil.isTrueOption("show_translit"),l[4]],trans_ipa:[ke.ext.util.storageUtil.isTrueOption("show_ipa"),l[2]],detected_lang:l[5],from:t,from_unmodified:n,to:a,reversed:r,correction:s,json:l})};!e.dontSaveInCache&&ke.ext.util.storageUtil.isTrueOption("history")?(r&&(l[5]=n,l[6]=i),ke.ext.cache.saveOrUpdate(n,i,e.text,l,e.source,u)):u()}else o({no_results:!0})},r=function(e,t){if((ke.ext.util.storageUtil.isTrueOption("show_ipa")||ke.ext.util.storageUtil.isTrueOption("show_articles"))&&ke.isProUser&&e[3].length<=ke.ext.googleApi.MAX_IPA_LEN){var n=[];n.push({word:e[1],language:e[5]}),n.push({word:e[3],language:e[6]}),e[7][1].length>0&&e[7][1].forEach((t=>{n.push({word:t[0],language:e[6]})})),ke.ext.googleApi.getWordsInfo(n,(function(n){$.isArray(n.words_info)&&n.words_info.forEach((t=>{if(t.word===e[1])ke.ext.googleApi.IPA_LANGS.indexOf(e[5])>-1&&(e[10]=t.ipa||""),e[8]=t.info&&t.info.gender||"";else if(t.word===e[3])ke.ext.googleApi.IPA_LANGS.indexOf(e[6])>-1&&(e[2]=t.ipa||""),e[9]=t.info&&t.info.gender||"";else if(e[7][1].length>0)for(var n=0;n<e[7][1].length;++n)e[7][1][n][0]===t.word&&!e[7][1][n][2]&&t.info&&t.info.gender&&(e[7][1][n][2]=t.info.gender)})),l(e,t)}))}else l(e,t)},s=ke.ext.googleApi.getInternalJSONFormat(t,e.text);s[6]=i,s[5]===i&&n!==i&&"auto"!==n?ke.ext.googleApi.getTextTranslation(i,n,e.text,(function(t){if(t.error)o({offline:!0});else{var n=ke.ext.googleApi.getInternalJSONFormat(t,e.text);n[6]=i,r(n,!0)}})):r(s,!1)}}))},resetMonthlyCounter:function(){Date.now()-ke.ext.util.storageUtil.getIntValue("last_monthly_reset")>=ke.TIME.ONE_MONTH&&(ke.ext.util.storageUtil.setIntValue("monthly_trans_count",0),ke.ext.util.storageUtil.setIntValue("last_monthly_reset",Date.now()))},getTranslationPageLink:function(e,t){t({link:ke.ext.googleApi.getTranslationPageLink(e.text,e.from,e.to)})}});