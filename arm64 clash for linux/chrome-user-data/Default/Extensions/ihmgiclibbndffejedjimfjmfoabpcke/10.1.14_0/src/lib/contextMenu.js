!function(e,n,t,i){"use strict";var a;e.single=(a=e({}),function(e){return a[0]=e,a}),e.fn.contextMenu=function(n,t,i){o[n]?t&&(t instanceof Array||"string"==typeof t||t.nodeType||t.jquery||(i=t,t=null)):(i=t,t=n,n="popup"),t instanceof Array&&"update"!=n&&(n="menu");var a=i;return e.inArray(n,["menu","popup","close","destroy"])>-1?(i=r.optionOtimizer(n,i),this.each((function(){var r=e(this);(a=e.extend({},e.fn.contextMenu.defaults,i)).baseTrigger||(a.baseTrigger=r),o[n].call(r,t,a)}))):o[n].call(this,t,a),this},e.fn.contextMenu.defaults={triggerOn:"click",subMenuTriggerOn:"hover click",displayAround:"cursor",mouseClick:"left",verAdjust:0,horAdjust:0,top:"auto",left:"auto",closeOther:!0,containment:n,winEventClose:!0,position:"auto",closeOnClick:!0,onOpen:function(e,n){},afterOpen:function(e,n){},onClose:function(e,n){}};var o={menu:function(e,n){e=r.createMenuList(this,e,n),r.contextMenuBind.call(this,e,n,"menu")},popup:function(n,t){e(n).addClass("iw-contextMenu"),r.contextMenuBind.call(this,n,t,"popup")},update:function(n,t){var a=this;t=t||{},this.each((function(){var o=e(this),u=o.data("iw-menuData");u||(a.contextMenu("refresh"),u=o.data("iw-menuData"));var s=u.menu;if("object"==typeof n)for(var c=0;c<n.length;c++){var l=n[c].name,d=n[c].disable,m=n[c].fun,f=n[c].icon,g=n[c].img,p=n[c].title,h=n[c].className,w=s.children("li").filter((function(){return e(this).contents().filter((function(){return 3==this.nodeType})).text()==l})),v=n[c].subMenu;d!=i&&(d?w.addClass("iw-mDisable"):w.removeClass("iw-mDisable")),m&&w.unbind("click.contextMenu").bind("click.contextMenu",m),p!=i&&w.attr("title",p),h!=i&&w.attr("class",h);var M=w.find(".iw-mIcon");M.length&&M.remove(),g?w.prepend('<img src="'+g+'" align="absmiddle" class="iw-mIcon" />'):f&&w.prepend('<span align="absmiddle" class="iw-mIcon '+f+'" />'),v&&w.contextMenu("update",v)}r.onOff(s);var x=t.triggerOn;if(x){o.unbind(".contextMenu");for(var b=[],C=(c=0,(x=x.split(" ")).length);c<C;c++)b.push(x[c]+".contextMenu");o.bind(b.join(" "),r.eventHandler)}u.option=e.extend({},u.option,t),o.data("iw-menuData",u)}))},refresh:function(){var n=this.filter((function(){return!!e(this).data("iw-menuData")})).data("iw-menuData"),t=this.filter((function(){return!e(this).data("iw-menuData")}));n.option.baseTrigger=this,r.contextMenuBind.call(t,n.menuSelector,n.option)},open:function(n,t){var i=(t=t||{}).event||e.Event("click");t.top&&(i.clientY=t.top),t.left&&(i.clientX=t.left),this.each((function(){r.eventHandler.call(this,i)}))},close:function(){var e=this.data("iw-menuData");e&&r.closeContextMenu(e.option,this,e.menu,null)},value:function(e){var n=this.data("iw-menuData");return n[e]?n[e]:n.option?n.option[e]:null},destroy:function(){var n=this.data("iw-menuData").menuId,t=e(".iw-contextMenu[menuId="+n+"]"),i=t.data("iw-menuData");i&&(1==i.noTrigger?t.hasClass("iw-created")?t.remove():(t.removeClass("iw-contextMenu "+n).removeAttr("menuId").removeData("iw-menuData"),t.find("li.iw-mTrigger").contextMenu("destroy")):(i.noTrigger--,t.data("iw-menuData",i)),this.unbind(".contextMenu").removeClass("iw-mTrigger").removeData("iw-menuData"))}},r={contextMenuBind:function(n,t,i){var a=this,o=e(n),u=o.data("iw-menuData");if(0!=o.length||0!=(o=a.find(n)).length){"menu"==i&&r.menuHover(o);var s=t.baseTrigger;if(u)u.noTrigger++,o.data("iw-menuData",u);else{var c;s.data("iw-menuData")?c=s.data("iw-menuData").menuId:(c=Math.ceil(1e5*Math.random()),s.data("iw-menuData",{menuId:c}));var l=o.clone();l.appendTo("body"),u={menuId:c,menuWidth:l.outerWidth(!0),menuHeight:l.outerHeight(!0),noTrigger:1,trigger:a},o.data("iw-menuData",u).attr("menuId",c),l.remove()}a.addClass("iw-mTrigger").data("iw-menuData",{menuId:u.menuId,option:t,menu:o,menuSelector:n,method:i});var d=t.triggerOn;-1!=d.indexOf("hover")&&(d=d.replace("hover","mouseenter"),-1!=s.index(a)&&s.add(o).bind("mouseleave.contextMenu",(function(n){0==e(n.relatedTarget).closest(".iw-contextMenu").length&&e('.iw-contextMenu[menuId="'+u.menuId+'"]').fadeOut(100)}))),a.delegate("input,a,.needs-click","click",(function(e){e.stopImmediatePropagation()}));for(var m=[],f=0,g=(d=d.split(" ")).length;f<g;f++)m.push(d[f]+".contextMenu");a.bind(m.join(" "),r.eventHandler),o.bind("click mouseenter",(function(e){e.stopPropagation()})),o.delegate("li","click",(function(n){t.closeOnClick&&!e.single(this).hasClass("iw-has-submenu")&&r.closeContextMenu(t,a,o,n)}))}},eventHandler:function(i){i.preventDefault();var a=e(this),o=a.data("iw-menuData"),u=o.menu,s=u.data("iw-menuData"),c=o.option,l=c.containment,d={trigger:a,menu:u},m=l==n,f=-1==c.baseTrigger.index(a);!f&&c.closeOther&&e(".iw-contextMenu").css("display","none"),u.find(".iw-mSelected").removeClass("iw-mSelected"),c.onOpen.call(this,d,i);var g,p,h,w,v=e(l),M=v.innerHeight(),x=v.innerWidth(),b=0,C=0,k=s.menuHeight,y=s.menuWidth,D=0,O=0,T=g=parseInt(c.verAdjust),I=p=parseInt(c.horAdjust);if(m||(b=v.offset().top,C=v.offset().left,"static"==v.css("position")&&v.css("position","relative")),"cursor"==c.displayAround)D=m?i.clientX:i.clientX+e(n).scrollLeft()-C,(h=(O=m?i.clientY:i.clientY+e(n).scrollTop()-b)+k)>M&&(O-k<0?h-M<k-O?(O=M-k,g*=-1):(O=0,g=0):(O-=k,g*=-1)),(w=D+y)>x&&(D-y<0?w-x<y-D?(D=x-y,p*=-1):(D=0,p=0):(D-=y,p*=-1));else if("trigger"==c.displayAround){var A=a.outerHeight(!0),E=a.outerWidth(!0),H=m?a.offset().left-v.scrollLeft():a.offset().left-C,S=m?a.offset().top-v.scrollTop():a.offset().top-b,j=E;(h=(O=S)+k)>M&&(O-k<0?h-M<k-O?(O=M-k,g*=-1):(O=0,g=0):(O=O-k+A,g*=-1)),(w=(D=H+E)+y)>x&&(D-y<0?w-x<y-D?(D=x-y,p*=-1,j=-E):(D=0,p=0,j=0):(D=D-y-E,p*=-1,j=-E)),"top"==c.position?(O=S-k,g=T,D-=j):"left"==c.position?(D=H-y,p=I):"bottom"==c.position?(O=S+A,g=T,D-=j):"right"==c.position&&(D=H+E,p=I)}var z={position:m||f?"fixed":"absolute",display:"inline-block",height:"",width:""};if("auto"!=c.left&&(D=r.getPxSize(c.left,x)),"auto"!=c.top&&(O=r.getPxSize(c.top,M)),!m){var P=a.offsetParent().offset();f?(D=D+C-e(n).scrollLeft(),O=O+b-e(n).scrollTop()):(D-=C-P.left,O-=b-P.top)}z.left=D+p+"px",z.top=O+g+"px",u.css(z),c.afterOpen.call(this,d,i),0==a.closest(".iw-contextMenu").length&&(e(".iw-curMenu").removeClass("iw-curMenu"),u.addClass("iw-curMenu"));var L={trigger:a,menu:u,option:c,method:o.method};e("html").unbind("click",r.clickEvent).click(L,r.clickEvent),e(t).unbind("keydown",r.keyEvent).keydown(L,r.keyEvent),c.winEventClose&&e(n).bind("scroll resize",L,r.scrollEvent)},scrollEvent:function(e){r.closeContextMenu(e.data.option,e.data.trigger,e.data.menu,e)},clickEvent:function(n){n.data.trigger.get(0)!==n.target&&0==e(n.target).closest(".iw-contextMenu").length&&r.closeContextMenu(n.data.option,n.data.trigger,n.data.menu,n)},keyEvent:function(n){n.preventDefault();var t=n.data.menu,i=n.data.option,a=n.keyCode;if(27==a&&r.closeContextMenu(i,n.data.trigger,t,n),"menu"==n.data.method){var o=e(".iw-curMenu"),u=o.children("li:not(.iw-mDisable)"),s=u.filter(".iw-mSelected"),c=u.index(s),l=function(e){r.selectMenu(o,e),e.data("iw-menuData")&&r.eventHandler.call(e[0],n)},d=function(){l(u.filter(":first"))},m=function(){l(u.filter(":last"))};switch(a){case 13:s.click();break;case 40:c==u.length-1||0==s.length?d():l(u.filter(":eq("+(c+1)+")"));break;case 38:0==c||0==s.length?m():l(u.filter(":eq("+(c-1)+")"));break;case 33:d();break;case 34:m();break;case 37:!function(){var e=o.data("iw-menuData").trigger.closest(".iw-contextMenu");0!=e.length&&(o.removeClass("iw-curMenu").css("display","none"),e.addClass("iw-curMenu"))}();break;case 39:!function(){var e=s.data("iw-menuData");if(e){r.eventHandler.call(s[0],n);var t=e.menu;t.addClass("iw-curMenu"),o.removeClass("iw-curMenu"),u=(o=t).children("li:not(.iw-mDisable)"),s=u.filter(".iw-mSelected"),d()}}()}}},closeContextMenu:function(i,a,o,u){e(t).unbind("keydown",r.keyEvent),e("html").unbind("click",r.clickEvent),e(n).unbind("scroll resize",r.scrollEvent),e(".iw-contextMenu").css("display","none"),e(t).focus(),i.onClose.call(this,{trigger:a,menu:o},u)},getPxSize:function(e,n){return isNaN(e)?-1!=e.indexOf("%")?parseInt(e)*n/100:parseInt(e):e},selectMenu:function(e,n){var t=e.find("li.iw-mSelected"),i=t.find(".iw-contextMenu");0!=i.length&&t[0]!=n[0]&&i.fadeOut(100),t.removeClass("iw-mSelected"),n.addClass("iw-mSelected")},menuHover:function(n){Date.now();n.children("li").bind("mouseenter.contextMenu click.contextMenu",(function(t){e(".iw-curMenu").removeClass("iw-curMenu"),n.addClass("iw-curMenu"),r.selectMenu(n,e(this))}))},createMenuList:function(t,i,a){var o=a.baseTrigger,u=Math.floor(1e4*Math.random());if("object"==typeof i&&!i.nodeType&&!i.jquery){var s=e('<ul class="iw-contextMenu iw-created iw-cm-menu" id="iw-contextMenu'+u+'"></ul>');if(e.each(i,(function(n,t){var i=t.name,u=t.fun||function(){},c=t.subMenu,l=t.img||"",d=t.icon||"",m=t.title||"",f=t.className||"",g=t.disable,p=e('<li title="'+m+'" class="'+f+'">'+i+"</li>");l?p.prepend('<img src="'+l+'" align="absmiddle" class="iw-mIcon" />'):d&&p.prepend('<span align="absmiddle" class="iw-mIcon '+d+'" />'),g&&p.addClass("iw-mDisable"),c||p.bind("click.contextMenu",(function(e){u.call(this,{trigger:o,menu:s},e)})),s.append(p),c&&(p.addClass("iw-has-submenu").append('<div class="iw-cm-arrow-right" />'),r.subMenu(p,c,o,a))})),-1==o.index(t[0]))t.append(s);else{var c=a.containment==n?"body":a.containment;e(c).append(s)}return r.onOff(e("#iw-contextMenu"+u)),"#iw-contextMenu"+u}if(0!=e(i).length){var l=e(i);return l.removeClass("iw-contextMenuCurrent").addClass("iw-contextMenu iw-cm-menu iw-contextMenu"+u).attr("menuId","iw-contextMenu"+u).css("display","none"),l.find("ul").each((function(n,t){var i=e(this),u=i.parent("li");u.append('<div class="iw-cm-arrow-right" />'),i.addClass("iw-contextMenuCurrent"),r.subMenu(u,".iw-contextMenuCurrent",o,a)})),r.onOff(e(".iw-contextMenu"+u)),".iw-contextMenu"+u}},subMenu:function(e,n,t,i){e.contextMenu("menu",n,{triggerOn:i.subMenuTriggerOn,displayAround:"trigger",position:"auto",mouseClick:"left",baseTrigger:t,containment:i.containment})},onOff:function(n){n.find(".iw-mOverlay").remove(),n.find(".iw-mDisable").each((function(){var n=e(this);n.append('<div class="iw-mOverlay"/>'),n.find(".iw-mOverlay").bind("click mouseenter",(function(e){e.stopPropagation()}))}))},optionOtimizer:function(n,t){if(t)return"menu"==n&&(t.mouseClick||(t.mouseClick="right")),"right"==t.mouseClick&&"click"==t.triggerOn&&(t.triggerOn="contextmenu"),-1!=e.inArray(t.triggerOn,["hover","mouseenter","mouseover","mouseleave","mouseout","focusin","focusout"])&&(t.displayAround="trigger"),t}}}(jQuery,window,document);