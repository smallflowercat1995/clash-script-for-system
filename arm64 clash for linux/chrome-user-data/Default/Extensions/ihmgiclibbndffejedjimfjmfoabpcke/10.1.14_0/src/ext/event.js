!function(e){for(var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",27:"escape",37:"left arrow",39:"right arrow",38:"up arrow",40:"down arrow",46:"delete",91:"cmd left",93:"cmd right","91-93":"cmd",106:"multiply",107:"add",109:"subtract",110:"^",111:"\\",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",221:"]",222:"'",220:"\\",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",33:"pgup",34:"pgdown",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},n={enter:13,shift:16,ctrl:17,alt:18,esc:27,space:32,cmd:[91,93],arrowup:38,arrowdown:40,tilde:192,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},o={"=":187,"-":189,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57},r=65;r<=90;++r)n[String.fromCharCode(r+32)]=r,o[String.fromCharCode(r+32)]=r;var i={alt:!0,ctrl:!0,shift:!0,cmd:!0,f1:!0,f2:!0,f3:!0,f4:!0,f5:!0,f6:!0,f7:!0,f8:!0,f9:!0,f10:!0,f11:!0,f12:!0,win:!0},f=function(e){return e in i},s=function(e){return e in o};pl.extend(ke.ext.event,{isKeyCodeLetter:function(e){return(e=+e)>=65&&e<=90},isControlKey:function(e){for(var t in e=+e,n){var o=$.isArray(n[t]);if(!this.isKeyCodeLetter(e)&&(o?$.inArray(e,n[t])>-1:n[t]===e))return!0}return!1},isValidKeyCode:function(e){return e=+e,this.isKeyCodeLetter(e)||e in t},checkMultipleKeyCodes:function(e){return e in{91:0,93:0}?"91-93":e},getNicePresentationForKeyCode:function(e){if(this.isKeyCodeLetter(+e))return String.fromCharCode(+e);var n=null;for(var o in t)"string"==typeof o&&o.indexOf(e)>-1&&o.indexOf("-")>-1&&(n=t[o]);return n||t[e]},filter:function(e){for(var t=(e=e.toLowerCase()).split("+"),n=[],o=null,r=!1,i=0,a=t.length;i<a;++i)f(t[i])?(r=!0,n.push(t[i])):s(t[i])&&!o&&(o=t[i]);return o&&n.push(o),r&&o?n.join("+"):""},is:function(e,t){var n,o=e.split("+"),r=!0;return pl.each(o,(function(e,o){var i=o.split("-");n=!1,pl.each(i,(function(e,o){t.keyCode===+o&&(n=!0)})),n||(r=!1)})),r},IN_STR:1,IN_CODES:2,isDown:function(e,t,n){var o;t||(t=this.IN_STR),t===this.IN_STR?o=this.getKeyCodeCombinationFromName(e,!1):t===this.IN_CODES&&(o=e.split("+"));for(var r=0,i=o.length;r<i;++r)if(!(n||this.keysDown)[o[r]])return!1;return!0},getKeyCodeCombinationFromName:function(e,t){for(var r=e.split("+"),i=[],f=0,s=r.length;f<s;++f){var a=n[r[f].toLowerCase()]||o[r[f].toLowerCase()];i.push($.isArray(a)?a.join("-"):a)}return t?i.join("+"):i},getNameFromKeyCodeCombination:function(e){for(var o=e.split("+"),r=[],i=0,f=o.length;i<f;++i)r.push(ke.capitalize(t[o[i]]||ke.getKeyByVal(n,o[i])||""));return r.join("+")},getNecessaryInfo:function(e){return{keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey}},keysDown:{},forget:function(){$(document).off("keydown"),$(document).off("keyup"),this.keysDown={}},isModKey:f,isRegKey:s,listen:function(e,t,n,o){var r=this;$(o||document).on("keydown",(function(t){r.isValidKeyCode(t.keyCode)&&(!function(e,t){if(r.isKeyCodeLetter(e))for(var n in t)r.isKeyCodeLetter(n)&&delete t[n]}(t.keyCode,r.keysDown),function(e,t){if(!r.isControlKey(e))for(var n in t)r.isControlKey(n)||delete t[n]}(t.keyCode,r.keysDown),r.keysDown[r.checkMultipleKeyCodes(t.keyCode)]=!0,t.metaKey&&(r.keysDown["91-93"]=!0),e(r.keysDown),n())})),$(o||document).on("keyup",(function(e){var n=e.keyCode,o=ke.ext.event.checkMultipleKeyCodes(e.keyCode);delete r.keysDown[n],delete r.keysDown[o],t(n,o)}))}})}();