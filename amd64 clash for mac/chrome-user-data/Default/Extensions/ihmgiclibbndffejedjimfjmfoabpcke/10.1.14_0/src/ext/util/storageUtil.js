!function(e){ke.import("ext.const.storage");var t=function(e,t,o){var a=pl.JSON(localStorage[ke.getStorageConst(e)]);a[o](t),localStorage.setItem(ke.getStorageConst(e),pl.stringify(a))},o=function(e,t){var o=pl.JSON(localStorage[ke.getStorageConst(e)]);o[t](),localStorage.setItem(ke.getStorageConst(e),pl.stringify(o))};pl.extend(ke.ext.util.storageUtil,{initStorage:function(e){var t,o,a=[];for(var n in ke.ext.const.storage)a.push(n),localStorage[ke.ext.const.storage[n]]||(t=ke.getStorageDefValue(n),o=pl.type(t,"obj")||pl.type(t,"arr")?pl.stringify(t):t,localStorage.setItem(ke.getStorageConst(n),o));ke.IS_SAFARI?e():chrome.storage.local.get(a,(function(t){for(var o in t){var a=ke.getStorageDefValue(o);t[o]&&t[o]!==a&&ke.ext.util.storageUtil.setVal(o,t[o])}e()}))},saveValue:function(e,t){ke.IS_SAFARI||("background"!==ke.section?chrome.runtime.sendMessage({action:ke.processCall("app","opt","saveSettingsPersistently"),field:e,value:t}):ke.app.handlers._processEventHandlers.app.opt.saveSettingsPersistently({field:e,value:t}))},requestProStatus:function(e){ke.ext.util.storageUtil.chainRequestBackgroundOption([{fn:"getDecodedVal",args:["sub_data"]},{fn:"isTrueOption",args:["chr_pro_flag"]}],(function(t){e&&e(t[0].response.isSubscriptionVerified||t[1].response)}),!1)},requestBackgroundOption:function(e,t,o,a){ke.ext.util.storageUtil.chainRequestBackgroundOption([{fn:e,args:t}],(function(e){o&&o(e[0].response)}),a)},chainRequestBackgroundOption:function(e,t,o){if(o){var a=[];e.forEach((function(e){if("object"==typeof e){var t=ke.ext.util.storageUtil[e.fn].apply(ke.ext.util.storageUtil,e.args);a.push({response:t})}})),t&&t(a)}else chrome.runtime.sendMessage({action:ke.processCall("app","opt","chainRequestBackgroundOption"),calls:e},(function(e){t&&t(e)}))},isTrueOption:function(e){return"true"==localStorage[ke.getStorageConst(e)]},setOptionAsBoolean:function(e,t){var o=pl.type(t,"bool")?t:"true"==t;localStorage.setItem(ke.getStorageConst(e),o),ke.ext.util.storageUtil.saveValue(e,o)},isActiveJsonOption:function(e){return!!pl.JSON(localStorage[ke.getStorageConst(e)]).active},setActiveJsonValueAsBoolean:function(e,t){var o=pl.JSON(localStorage[ke.getStorageConst(e)]);o.active=t,localStorage.setItem(ke.getStorageConst(e),pl.stringify(o))},setJsonField:function(e,t,o){var a=function(e,t,o){t.length>1?a(e[t.shift()],t,o):e[t[0]]=o},n=pl.JSON(localStorage[ke.getStorageConst(e)]),r=t.split(".");a(n,r,o);var l=pl.stringify(n);localStorage.setItem(ke.getStorageConst(e),l),ke.ext.util.storageUtil.saveValue(e,l)},getJsonField:function(e,t){return pl.JSON(localStorage[ke.getStorageConst(e)])[t]},setJsonVal:function(e,t){ke.ext.util.storageUtil.setJsonField(e,"value",t)},getJsonVal:function(e){return ke.ext.util.storageUtil.getJsonField(e,"value")},setVal:function(e,t){localStorage.setItem(ke.getStorageConst(e),t),ke.ext.util.storageUtil.saveValue(e,t)},getVal:function(e){return localStorage[ke.getStorageConst(e)]},encodeAndSet:function(e,t){var o=pl.stringify(t);localStorage.setItem(ke.getStorageConst(e),o),ke.ext.util.storageUtil.saveValue(e,o)},deleteJsonElementByKey:function(e,t){var o=this.getDecodedVal(e);delete o[t],this.encodeAndSet(e,o)},getArrayValLen:function(e){return ke.ext.util.storageUtil.getDecodedVal(e).length},getDecodedVal:function(e){let t=localStorage[ke.getStorageConst(e)];if(t)try{t=JSON.parse(t)}catch(t){console.log("Failed to get and decode the following JSON object: "+e)}return t||{}},pushArrayVal:function(e,o){t(e,o,"push")},unshiftArrayVal:function(e,o){t(e,o,"unshift")},addArrayVal:function(e,t){var o=this.getDecodedVal(e);pl.empty(o)&&(o=[]);var a=pl.inArray(t,o);if(~a){var n=[];n.push(o[a]),pl.each(o,(function(e,t){a!==e&&n.push(t)})),o=n}else o.unshift(t);var r=pl.stringify(o);localStorage.setItem(ke.getStorageConst(e),r),ke.ext.util.storageUtil.saveValue(e,r)},popArrayVal:function(e){o(e,"pop")},shiftArrayVal:function(e){o(e,"shift")},spliceBySearch:function(e,t){for(var o,a=ke.ext.util.storageUtil.getDecodedVal(e),n=0,r=a.length;n<r;++n)if(a[n]===t){o=a.splice(n,1)[0];break}var l=pl.stringify(a);return localStorage.setItem(ke.getStorageConst(e),l),ke.ext.util.storageUtil.saveValue(e,l),o},setIntValue:function(e,t){this.setVal(e,t+"")},getIntValue:function(e){return+this.getVal(e)},incrementIntValue:function(e){var t=this.getIntValue(e)+1;return this.setVal(e,t+""),t},isEmpty:function(e){return pl.empty(this.getVal(e))},isEmptyArray:function(e){return pl.empty(this.getDecodedVal(e))},clear:function(){for(var e in localStorage)delete localStorage[e]},isIntlMonetizationOn:function(){return this.isTrueOption("monetization")&&"ru"!==ke.getCurrentLocale()}})}();