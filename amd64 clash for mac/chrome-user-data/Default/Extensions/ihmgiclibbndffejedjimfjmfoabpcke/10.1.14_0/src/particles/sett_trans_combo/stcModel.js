!function(e){ke.import("ext.util.storageUtil");pl.extend(ke.particles.sett_trans_combo.model,{onCCheckboxChange:function(e){ke.ext.util.storageUtil.requestBackgroundOption("setOptionAsBoolean",["key_combo",e]),ke.particles.sett_trans_combo.model.ctrlComboVisibility("slide"+(e?"Down":"Up"))},onComboDropdownOpen:function(e,t){ke.particles.scrollbars.model.setupComboOptionsDropdownScroll(e,t)},isFromSel:function(e){return function(e,t){for(var o=0+t;o<=e;o+=3)if(o===e)return!0;return!1}(e,-2)},getCombinationItemData:function(e){if(!(e=e.get?e:pl(e)).hasClass("combo-select"))for(var t=0;!(e=e.parent()).hasClass("combo-select")&&++t<100;);return{node:e.get(),is_main:e.hasClass("main-combo"),from:e.attr("data-from"),to:e.attr("data-to"),combo:e.attr("data-combo"),index1:+e.attr("data-index1"),index2:+e.attr("data-index2"),index3:+e.attr("data-index3")}},onComboDropdownChange:function(e,t,o){ke.ext.util.storageUtil.requestBackgroundOption("getDecodedVal",["add_trans_combinations"],(function(o){var n=ke.particles.sett_trans_combo.model.getCombinationItemData(".opt-"+e),a=!1;n.is_main?(ke.particles.sett_trans_combo.model.isFromSel(e)?(ke.ext.util.storageUtil.requestBackgroundOption("setVal",["from_lang",t]),$(n.node).attr("data-from",t)):(ke.ext.util.storageUtil.requestBackgroundOption("setVal",["to_lang",t]),$(n.node).attr("data-to",t)),a=!0,chrome.runtime.sendMessage({action:ke.processCall("app","opt","generateDropdownHtml"),serial:e},(function(e){ke.app.initCombinationsDropdown(e.old_data.serial)}))):(o[n.combo]=o[n.combo]||{},ke.particles.sett_trans_combo.model.isFromSel(e)?(o[n.combo].from=t,$(n.node).attr("data-from",t)):(o[n.combo].to=t,$(n.node).attr("data-to",t))),ke.ext.util.storageUtil.requestBackgroundOption("encodeAndSet",["add_trans_combinations",o],(function(){chrome.runtime.sendMessage({action:ke.processCall("app","option","updateContextMenu")})})),a||ke.app.initCombinationsDropdown(e)}))},ctrlComboVisibility:function(e,t){ke.ext.util.storageUtil.requestBackgroundOption("isTrueOption",["key_combo"],(function(o){ke.ui_views.visibility.ctrl(e,ke.getSelectorConst("settings","col_combo"),o,ke.particles.sett_trans_combo.model.ctrlComboVisibility,t)}))},removeCombination:function(e){var t=ke.particles.sett_trans_combo.model.getCombinationItemData(this);ke.ext.util.storageUtil.requestBackgroundOption("deleteJsonElementByKey",["add_trans_combinations",t.combo],(function(){chrome.runtime.sendMessage({action:ke.processCall("app","option","updateContextMenu")})})),$(".cs-"+t.index3).animate({height:0,opacity:0},ke.getAnimSpeed("fast_slide_up"),"easeOutQuint",(function(){$(this).remove(),--ke.app.temp.combos,ke.particles.sett_trans_combo.model.ctrlNewComboClass()}))},ctrlNewComboClass:function(){pl(".new-combo-button")[0==ke.app.temp.combos?"addClass":"removeClass"]("no-combos")},addCombination:function(e){ke.isProUser?ke.app.temp.combos<20?(ke.particles.sett_trans_combo.view.renderCombination("","",!1,!0,""),ke.app.initCombinationsDropdown(".cs-"+ke.particles.sett_trans_combo.view.getLastIndex()),ke.particles.sett_trans_combo.model.ctrlNewComboClass(),"undefined"!=typeof ga&&ga("send","event","options","shortcuts","add")):("undefined"!=typeof ga&&ga("send","event","options","shortcuts","max-reached"),alert(ke.getLocale("Settings_21max"))):ke.ui.pro_alert.show(ke.getLocale("Pro_ShortcutsFeature"),"shortcuts")},validDownKeys:{},getDownKeysAsCombo:function(e){var t=[];for(var o in e||this.validDownKeys)t.push(ke.ext.event.getNicePresentationForKeyCode(o));return t.join("+")},activateKeysDetection:function(e){$(this).addClass("ccw-active");var t=$(this).data("combo");ke.particles.sett_trans_combo.model.currentActiveFieldIndex=+$(this).data("combo-id"),ke.particles.sett_trans_combo.model.validDownKeys={},t&&t.split("+").forEach((function(e){ke.particles.sett_trans_combo.model.validDownKeys[+e]=!0})),ke.particles.sett_trans_combo.model.listenToCombinations(),e.stopPropagation(),$("body").on("click",ke.particles.sett_trans_combo.model.deactivateKeysDetection)},deactivateKeysDetection:function(){$(".combo-"+ke.particles.sett_trans_combo.model.currentActiveFieldIndex).removeClass("ccw-active"),ke.ext.event.forget(),ke.particles.sett_trans_combo.model.closeCombinationChange(ke.particles.sett_trans_combo.model.currentActiveFieldIndex),$("body").off("click",ke.particles.sett_trans_combo.model.deactivateKeysDetection)},clearKeys:function(e){e.stopPropagation();var t=$(this).data("id"),o=$(".combo-"+t);o.attr("data-combo","").parent().attr("data-combo",""),ke.particles.sett_trans_combo.model.currentActiveFieldIndex||(ke.particles.sett_trans_combo.model.currentActiveFieldIndex=t),ke.particles.sett_trans_combo.model.validDownKeys={},ke.particles.sett_trans_combo.model.updateCurrentState(null,o),ke.particles.sett_trans_combo.model.deactivateKeysDetection(),ke.particles.sett_trans_combo.model.currentActiveFieldIndex=null},listenToCombinations:function(){ke.ext.event.listen((function(e){var t=ke.particles.sett_trans_combo.model.getDownKeysAsCombo(e),o=ke.ext.event.filter(t);if(o){var n=ke.ext.event.getKeyCodeCombinationFromName(o);ke.particles.sett_trans_combo.model.validDownKeys={},n.forEach((function(e){ke.particles.sett_trans_combo.model.validDownKeys[e]=!0})),$(".combo-"+ke.particles.sett_trans_combo.model.currentActiveFieldIndex).attr("data-combo",n.join("+")).parent().attr("data-combo",n.join("+")),ke.particles.sett_trans_combo.model.deactivateKeysDetection()}}),(function(e,t){}),this.updateCurrentState)},placeholderToggleTimeout:null,sortCurrentKeys:function(e,t){var o=[],n=t.find(".ccw-keys");if(e)o=e;else{for(var a in ke.particles.sett_trans_combo.model.validDownKeys)o.push(a);o.sort((function(e,t){return e=ke.ext.event.getNicePresentationForKeyCode(e),t=ke.ext.event.getNicePresentationForKeyCode(t),ke.ext.event.isModKey(e)&&!ke.ext.event.isModKey(t)?-1:!ke.ext.event.isModKey(e)&&ke.ext.event.isModKey(t)?1:0}))}n.html("");for(var i=0,s=o.length;i<s;++i)o[i]&&n.append(ke.ext.tpl.compile('<div class="ccw-combo combo-<%=code%>" data-code="<%=code%>"><%=name%></div>',{code:ke.ext.event.checkMultipleKeyCodes(o[i]),name:ke.ext.event.getNicePresentationForKeyCode(o[i])}))},currentActiveFieldIndex:null,updateCurrentState:function(e,t){if(t){if(!t&&!ke.particles.sett_trans_combo.model.currentActiveFieldIndex)return}else t=$(".combo-"+ke.particles.sett_trans_combo.model.currentActiveFieldIndex);e=function(e){if(!e)return e;for(var t=[],o=0,n=e.length;o<n;++o)e[o]&&t.push(e[o]);return t}(e),$.isEmptyObject(ke.particles.sett_trans_combo.model.validDownKeys)&&$.isEmptyObject(e)?(t.find(".not-empty-combo").hide(),t.find(".empty-combo").show()):(t.find(".empty-combo").hide(),t.find(".not-empty-combo").show(),ke.particles.sett_trans_combo.model.sortCurrentKeys(e,t))},closeCombinationChange:function(e){var t=ke.particles.sett_trans_combo.model.getCombinationItemData(".combo-"+e);if(t.is_main)ke.ext.util.storageUtil.requestBackgroundOption("setVal",["trans_combination",t.combo],(function(){chrome.runtime.sendMessage({action:ke.processCall("app","option","updateContextMenu")})}));else{var o=$(".combo-"+e).data("combo");ke.ext.util.storageUtil.requestBackgroundOption("getDecodedVal",["add_trans_combinations"],(function(e){e[o]=e[o]||{};try{e[o].from=ke.ui.dropdown.getActiveOptionValue(t.index1),e[o].to=ke.ui.dropdown.getActiveOptionValue(t.index2)}catch(e){}e[t.combo]=e[o],delete e[o],ke.ext.util.storageUtil.requestBackgroundOption("encodeAndSet",["add_trans_combinations",e],(function(){chrome.runtime.sendMessage({action:ke.processCall("app","option","updateContextMenu")})}))}))}}})}();