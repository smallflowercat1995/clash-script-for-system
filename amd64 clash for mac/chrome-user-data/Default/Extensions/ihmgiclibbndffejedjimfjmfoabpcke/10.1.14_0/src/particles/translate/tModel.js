!function(e){var t;ke.import("ext.event");var a=$(".autocorrection-layout"),n=a.find(".ac-word"),i=$(".translation-input");pl.extend(ke.particles.translate.model,{ctrlInstantVisibility:function(e){pl(".translate-button")[e](),pl(".action-bar").addClass("centerized-ab")},showLoading:function(){$(".translate-button").hide(),$(".loading").show()},hideLoading:function(){$(".loading").hide(),$(".translate-button").show()},getTranslation:function(t,a,n,l){if(!ke.app.flags.isTranslating){l||ke.ext.util.storageUtil.encodeAndSet("caret_positions",{start:ke.app.$input.get(0).selectionStart,end:ke.app.$input.get(0).selectionEnd});var o=pl.trim(n!==e?n:i.val());if(!(o.length>ke.ext.googleApi.MAX_TEXT_LEN))return pl.empty(o)?(ke.app.prevInput=o,void ke.ui_views.empty_trans_states.displayEmptiness()):void((""!==o||a)&&(ke.app.prevInput=o,ke.ui_views.empty_trans_states.displayWorkaround(),ke.app.flags.isTranslating=!0,l||ke.particles.translate.model.showLoading(),ke.ext.util.storageUtil.chainRequestBackgroundOption([{fn:"isTrueOption",args:["autocorrection"]},{fn:"isTrueOption",args:["autoswap"]}],(function(e){var a=e[0].response;e[1].response;chrome.runtime.sendMessage({action:ke.processCall("app","translate","get"),identificator:"window",text:o,source:"popup"},(function(e){if(!e||e.no_results)return ke.app.$no_results.show(),void ke.particles.translate.model.hideLoading();ke.app.$no_results.hide(),e.reversed&&(ke.ui.dropdown.data.callback(1,e.to,null,!0),ke.ui.dropdown.data.callback(2,e.from,null,!1)),ke.app.flags.isTranslating=!1,ke.particles.translate.model.hideLoading(),$(".offline-cap").hide(),e.offline?($(".offline-cap").show(),ke.particles.listen.model.ctrlRawVisibility(!1,ke.ext.util.langUtil.getToLang())):e.error?t({network_error:!0}):!l&&e.correction&&a?(ke.app.flags.isAutocorrected=!0,ke.app.temp.valueBeforeAutocorrection=e.old_data.text,i.val(e.correction),ke.particles.tr_input.model.saveValueOnKeyup(),ke.particles.translate.model.getTranslation(t,!1,e.correction,!0),"undefined"!=typeof ga&&ga("send","event","autocorrection","clicked")):(l||(ke.app.flags.isAutocorrected=!1),e.code=ke.ext.tpl.compile(e.code,{from:ke.ext.util.langUtil.getFromLang(),to:ke.ext.util.langUtil.getToLang()}),t(e))}))}))))}},routeTranslation:function(t){if(t.network_error)return ke.ui_views.empty_trans_states.displayEmptiness(),ke.particles.listen.model.ctrlRawVisibility(e,""),void ke.particles.listen.model.ctrlTransVisibility();if(ke.app.flags.isPrevTranslationMulti=ke.app.flags.isCurrentTranslationMulti,ke.app.flags.isCurrentTranslationMulti=t.isMulti,ke.app.temp.currentDetectedLang=t.detected_lang||"",ke.app.temp.currentFromLang=t.from,ke.particles.listen.model.ctrlRawVisibility(e,t.detected_lang),ke.particles.translate.model.displayTranslation(t.code,t),!ke.app.flags.instant||ke.app.flags.isAutocorrected){var a=ke.ext.util.storageUtil.getDecodedVal("caret_positions");pl(".translation-input").createSelection(a.start,a.end)}},displayTranslation:function(e,t){var i=function(){$(".translation-layout").fadeOut(125,"easeInOutCirc",(function(){$(".translation-layout").html(e).fadeIn(125,"easeInOutCirc",(function(){ke.particles.listen.model.ctrlTransVisibility(!1,t.to),ke.particles.listen.model.ctrlSynonymVis(!1,t.to),ke.app.render.events.listenTranslation(),ke.app.render.events.listenSynonym(),ke.app.render.events.useSynonym(),ke.app.render.events.showArticleUpgrade(),ke.app.render.events.showIpaUpgrade(),ke.particles.three_dots.view.fillContextMenu($(".more-butt0n"),"auto"==t.from?t.detected_lang:t.from,t.to),"auto"===t.from_unmodified&&$(".from-lang .select").html("").append(ke.getLocale("Kernel_Lang_"+ke.ext.util.langUtil.getLangNameByKey(t.detected_lang))),!ke.app.flags.isNarrow&&ke.app.flags.isAutocorrected?(n.html(ke.app.temp.valueBeforeAutocorrection),a.show()):a.hide(),!t.isMulti&&t.json[3].length<35&&$(".padded-single-translation").addClass("short-padded-single-translation"),t.json[8]&&ke.ext.util.storageUtil.isTrueOption("show_articles")?ke.isProUser?($(".original-article").html(t.json[8]).slideDown(125,ke.app.handlers.adjustOriginalIpa),$(".translation-input").addClass("with-article")):($(".original-article").addClass("blurred-out").html("xyz").slideDown(125,ke.app.handlers.adjustOriginalIpa),$(".translation-input").addClass("with-article")):($(".original-article").slideUp(125,ke.app.handlers.adjustOriginalIpa),$(".translation-input").removeClass("with-article"));let e=ke.ext.googleApi.getSourceTranslitFromJson(t.json);if(ke.isProUser?$(".original-ipa").removeClass("blurred-out").html(e):(e=t.json[1],$(".mv-translit").addClass("blurred-out"),$(".original-ipa").addClass("blurred-out").html(e)),e&&ke.ext.util.storageUtil.isTrueOption("show_ipa")?$(".original-ipa").show():$(".original-ipa").hide(),ke.ext.util.storageUtil.isTrueOption("show_ipa")||$(".mv-translit").hide(),ke.ext.util.langUtil.isHieroglyphical(t.to)?$(".translation-layout").addClass("non-bold-contents"):$(".translation-layout").removeClass("non-bold-contents"),!ke.isProUser&&$(".v-item")[1]&&$(".variants-by-pos")[0]){let e=$(".variants-by-pos").height()-parseInt($(".synonyms-paywall").css("top")),t=ke.ext.dom.getPosition($(".v-item")[1])[1]-ke.ext.dom.getPosition($(".variants-by-pos")[0])[1];$(".synonyms-paywall").css({top:t+"px",height:e+"px","padding-top":234-t+"px"}),$(".synonyms-paywall .upgrade-cta").on("click",(()=>{ke.ui.pro_alert.show(ke.getLocale("Pro_SynonymsPaywall"),"toolbar-synonyms")}))}else $(".synonyms-paywall").remove();var i=".main-variant-wrap";t.isMulti||(i=".padded-single-translation"),$(i).dblclick((function(){var e=$(this).find(".mv-text-part").text().trim()||$(this).find(".tpart").text().trim();ke.ext.clipboard.copyToClipboard(e),ke.ui.notifications.show(ke.getLocale("Window_TranslationCopied"),2500),"undefined"!=typeof ga&&ga("send","event","window","double-click-copy")})),ke.IS_SAMSUNG||ke.particles.scrollbars.model.setupTranslationScroll()}))}))};ke.app.flags.isPrevTranslationMulti?$(".v-closest-wrap").slideUp(50,ke.getAnimType("slide_up")).promise().done((function(){$(".v-pos").fadeOut(25,ke.getAnimType("fade_out")).promise().done((function(){$(".main-variant-wrap").slideUp(75,ke.getAnimType("slide_up")).promise().done((function(){i()}))}))})):i()},translateSimple:function(e,t,a){ke.particles.translate.model.getTranslation(ke.particles.translate.model.routeTranslation,t,a),ke.particles.translate.model.toggleControls(a)},toggleControls:function(e){pl.empty(e||i.val())?ke.app.handlers.toggleRawControls(!0):ke.app.handlers.toggleRawControls(!1)},lastShortcutTranslationtime:Date.now(),checkTranslationShortcut:function(e,t){var a=Date.now(),n=ke.ext.event.is(ke.ext.event.getKeyCodeCombinationFromName("enter",!0),e),l=ke.ext.event.isDown("shift")&&n||ke.ext.event.isDown("ctrl")&&n||ke.ext.event.isDown("alt")&&n||ke.ext.event.isDown("cmd")&&n;if(1==t&&l)a-ke.particles.translate.model.lastShortcutTranslationtime>=1e3&&(ke.particles.translate.model.lastShortcutTranslationtime=a,ke.particles.translate.model.getTranslation(ke.particles.translate.model.routeTranslation)),e.preventDefault();else if(2==t&&!l&&n)a-ke.particles.translate.model.lastShortcutTranslationtime>=1e3&&(ke.particles.translate.model.lastShortcutTranslationtime=a,ke.particles.translate.model.getTranslation(ke.particles.translate.model.routeTranslation)),e.preventDefault();else if(2==t&&l){var o=i.val();i.val(o+"\n")}},translateOnKeyCombinations:function(e){ke.ext.event.isDown((ke.isMac?"cmd":"ctrl")+"+enter")&&(e.stopPropagation(),e.preventDefault(),ke.particles.translate.model.getTranslation(ke.particles.translate.model.routeTranslation))},translateOnKeyup:function(){return clearTimeout(t),ke.particles.translate.model.toggleControls(),t=setTimeout((function(){t=null,ke.particles.translate.model.getTranslation(ke.particles.translate.model.routeTranslation)}),725),!0}})}();