!function(e,t,n){var r={current:"",cl:[],list:{}},o=function(){},a="data,ext,ui".split(",");for(var i in e.ke={data:{},app:{},ui:{},import:{},ext:{},utils:{},db:{},idb:{},us:{},nav:{}},e.ke)~pl.inArray(i,a)||(ke.data[i]={});var s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";function c(e){for(var t="",n=e;n>0;--n)t+=s[Math.floor(Math.random()*s.length)];return t}e.indexedDB=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,e.speechRecognition=e.SpeechRecognition||e.mozSpeechRecognition||e.webkitSpeechRecognition||e.msSpeechRecognition,void 0!==e.msBrowser?e.chrome=msBrowser:"undefined"!=typeof browser&&(e.chrome=browser);const u={chrome:"chrome-extension://",opera:"chrome-extension://",edge:"ms-browser-extension://",firefox:"moz-extension://",safari:"safari-extension://",samsung:"internet-extension://"},l=()=>window.navigator.userAgent.toLowerCase().indexOf("edg/")>-1?"extension://":u[ke.PLATFORM_CODE];var d="readwrite",p="readonly";ke.loadExternalScript=function(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.setAttribute("type","text/javascript"),n.addEventListener("load",(function(){t(!0)}));var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r)},ke.import=function(e,t){return new ke.import.add(e,t||o)},pl.extend(ke.import,{ready:[],get prefix(){return~pl.inArray(ke.section,ke.data.kernel.save.internal_pages)?ke.getConst("ROOT_PREFIX"):""},parseType:function(e){return(e=e.replace(/\./g,"/")).substr(0,2)===ke.getConst("STYLE_PREFIX")?e.substr(2)+".css":e.substr(5,2)===ke.getConst("STYLE_PREFIX")?"root:"+e.substr(7)+".css":e+".js"},addRes:function(e){var t="",n="/";return ke.IS_SAFARI&&(t=ke.pathToExt,n=""),e.substr(0,5)===ke.getConst("ROOT_PREFIX")&&(t=ke.pathToExt,n="",e=e.substr(5)),t+(".css"===e.substr(e.length-4)?n+"res/styles/":n+"src/")+e},add:function(t,n){var r=(t=ke.import.prefix+t).substr(0,5)===ke.getConst("ROOT_PREFIX"),a=(t=ke.import.addRes(ke.import.parseType(t))).split("/").pop().split(".")[0],i=t.replace(ke.pathToExt,"/").split("/")[2];if(!~pl.inArray(t,ke.data.import.loaded))return ke.deploy[i]&&ke.deploy[i].before?ke.deploy[i].before(a,t.split("/").splice(-2,1)[0]):ke.deploy[i]={after:o},ke.import.ready.push(0),r?ke.IS_FIREFOX?chrome.runtime.sendMessage({action:ke.processCall("app","opt","attactContentFile"),src:t},(function(){ke.deploy[i].after(a,t.split("/").splice(-2,1)[0]),n(),ke.import.ready.pop()})):pl.ajax({url:t,type:"GET",success:function(r){".css"===t.substr(t.length-4)?pl("<style>",{type:"text/css"}).html(r).appendTo("head"):e.eval(r),ke.deploy[i].after(a,t.split("/").splice(-2,1)[0]),n(),ke.import.ready.pop()},error:function(e,t){}}):pl.attach({url:t,load:function(e,r){if(!pl.type(e,"str"))return n(),void ke.import.ready.pop();ke.data.import.loaded.push(pl.empty(ke.data.import.queue_name)?e:[ke.data.import.queue_name,e]),ke.import.ready.pop(),ke.deploy[i].after(a,t.split("/").splice(-2,1)[0]),"function"==typeof n&&n()}}),ke.import},onDone:function(e){var t=setInterval((function(){pl.empty(ke.import.ready)&&(clearInterval(t),e&&e())}),10)},getLoaded:function(){return ke.data.import.loaded}}),pl.extend(ke.data.import,{loaded:[]}),pl.extend(ke.data.db,r),pl.extend(ke.data.idb,r),pl.extend(ke.data.us,r);var f=navigator.appVersion.match("Chrome/([0-9.]+)")||navigator.userAgent.match("Firefox/([0-9.]+)");pl.extend(ke.data,{kernel:{const:{STYLE_PREFIX:"s:",ROOT_PREFIX:"root:",KERNEL_DB:"KE_Kernel",VERBOSE:!0},flags:{dom_loaded:!1,kumquat_ready:!1},info:{url:t.location.href,ver:f?f[1]:"(?)",lang:navigator.language,get id(){return ke.IS_FIREFOX?chrome.i18n.getMessage("@@extension_id"):ke.IS_SAFARI?safari.extension.baseURI.replace(/^safari-extension:\/\/|\/$/g,""):chrome.runtime.id}},save:{internal_pages:["content"]}}}),pl.extend(ke.data.kernel.info,{get section(){return ke.data.kernel.info.url.match(l())?ke.data.kernel.info.url.match(/([A-z0-9]+)\.html/)[1]:e.KumquatSection||"content"}}),pl.extend(ke,{log:function(){ke.getConst("VERBOSE")&&console.log.apply(console,arguments)},init:function(){ke.getFlag("kumquat_ready")||(ke.import("kernel.init").onDone((function(){ke.loadCurrentHub(),ke.data.kernel.save.user_init()})),ke.setFlagTrue("kumquat_ready"))},getExtensionProtocol:l,get section(){return ke.data.kernel.info.section},get extId(){return ke.data.kernel.info.id},get staticExtId(){return ke.IS_SAFARI?this.extId.split("/")[0]:ke.IS_FIREFOX?chrome.runtime.getManifest().applications.gecko.id:this.extId},get redirectableExtId(){return ke.IS_SAFARI?this.staticExtId:this.extId},get browserLang(){return window.navigator.language.split("-")[0].split("_")[0]},simplifyLC:function(e){return e.split("-")[0].split("_")[0]},isMac:window.navigator.platform.indexOf("Mac")>-1,isWindows:window.navigator.platform.indexOf("Win")>-1,IS_CHROME:!0,IS_OPERA:!1,IS_SAFARI:!1,IS_EDGE:!1,IS_FIREFOX:!1,IS_SAMSUNG:!1,PLATFORM_CODE:"chrome",get browserName(){return ke.IS_CHROME?"Chrome":ke.IS_OPERA?"Opera":ke.IS_FIREFOX?"Firefox":ke.IS_EDGE?"Edge":ke.IS_SAFARI?"Safari":ke.IS_SAMSUNG?"Samsung Internet":"Unknown"},get currentBrowser(){return ke.browserName+" "+ke.data.kernel.info.ver},get pathToExt(){let e=l();return window.navigator.userAgent.toLowerCase().indexOf("edg/")>-1&&(e="chrome-"+e),e+ke.extId+"/"},TIME:{ONE_DAY:864e5,ONE_MONTH:2629746e3},is_touch_device:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},generateUserId:function(e,t){for(var n=[],r=0;r<t;++r)n.push(c(e));return n.join("-")},getFlag:function(e){return ke.data.kernel.flags[e]},createFlag:function(e,t){pl.type(ke.data.kernel.flags[e],"undef")&&(ke.data.kernel.flags[e]=!pl.type(t,"undef")&&t)},setFlagTrue:function(e){pl.type(ke.data.kernel.flags[e],"undef")||(ke.data.kernel.flags[e]=!0)},setFlagFalse:function(e){pl.type(ke.data.kernel.flags[e],"undef")||(ke.data.kernel.flags[e]=!1)},getConst:function(e,t){t||(t=e,e="data.kernel");var n=ke,r=e.split(".");return pl.each(r,(function(e,t){n=n[t]})),n.const[t.toUpperCase()]},loadCurrentHub:function(){ke.IS_SAFARI&&(ke.import("ext.const.safari_locales"),ke.import("ext.compatibility.safari_browser")),ke.import("hub."+ke.section+".router"),ke.import("hub."+ke.section+".render"),ke.import("hub."+ke.section+".handlers").onDone((function(){var e=[];(ke.app.asyncInit||ke.EF)();var t=ke.app.import||[];pl.each(t,(function(t,n){e.push(0),ke.import(n).onDone((function(){e.pop()}))}));var n=setInterval((function(){if(pl.empty(e)&&(clearInterval(n),ke.app.init(),"background"!==ke.section)){var t=("content"===ke.section||ke.section===window.KumquatSection?"internal":"public")+"."+ke.section;ke.import("s:pages.common.main"),ke.import("s:pages."+t)}}),10)}))},getResource:function(e){return"/res/"+e},getImage:function(e){return this.getResource("images/"+e+".png")},getInternalPage:function(e){return"/pages/internal/"+e+".html"},isProcessCall:function(){var e=Array.prototype.slice.call(arguments,0),t=e[0];return e.splice(0,1),t===ke.processCall.call(ke,e)},processCall:function(){var e=[];return pl.each(arguments,(function(t,n){e.push(n)})),e.join(",")},parseProcessCall:function(e){if(!e)return{lib:"",cmd:"",exact:""};var t=e.split(",");return{lib:t[0],cmd:t[1],exact:t[2]}},getLocale:function(){var e=chrome.i18n.getMessage.apply(chrome,arguments);if(ke.IS_SAFARI&&(e=decodeURIComponent(e),window._locales)){var t=ke.getCurrentLocale(!0),n=(window._locales[t]||window._locales.en)[arguments[0]];if(n&&n.placeholders)for(var r in n.placeholders)e=e.replace("$"+r+"$",arguments[parseInt(n.placeholders[r].content.replace("$",""),10)])}return e},deploy:{hub:{before:function(e){"router"===e&&pl.extend(ke.app,{render:{},handlers:{}})},after:o},ext:{before:function(e,t){"ext"!==t?(ke.ext[t]=ke.ext[t]||{},ke.ext[t][e]={}):ke.ext[e]={}},after:function(e,t){pl.each((ke.ext[t]?ke.ext[t][e].import:ke.ext[e].import)||[],(function(e,t){ke.import(t)}))}},ui:{before:o,after:o}}}),pl.extend(ke.utils,{getObjectSize:function(e){var t=0;for(var n in e)++t;return t}});pl.extend(ke.db,{choose:function(e,t){return ke.data.db.current=e,t=function(e){if(pl.type(e,"int")||pl.type(e,"undef"))return e;var t=e.split(" "),n=t.pop().toLowerCase();return t[0]*Math.pow(1024,"mb"===n?2:1)}(t)||5*Math.pow(1024,2),ke.data.db.list[e]||(ke.data.db.list[e]=openDatabase(e,"1.0.0",e+" database",t),ke.data.db.list[e]||pl.error("Could not connect to the database.")),ke.data.db.list[e]},get selected(){return ke.data.db.current},get currentDb(){return pl.empty(ke.data.db.list)?null:ke.data.db.list[ke.data.db.current]},execSql:function(e,t,n,r){ke.db.currentDb.transaction((function(a){a.executeSql(e,t,(function(e,t){(n||o)(t)}),(function(e,t){(r||o)(t)}))}))}}),pl.extend(ke.idb,{structs:{},def_obj_struct:function(e,t){this.structs[e]=t},open:function(t,n,r,o){try{var a=e.indexedDB.open(t,r);ke.idb.cache[t]={},a.onupgradeneeded=function(e){var t=e.target.result;for(var r in n){t.objectStoreNames.contains(r)||t.createObjectStore(r,{autoIncrement:!0});var o=e.target.transaction.objectStore(r);for(var a in n[r])o.indexNames.contains(a)||o.createIndex(a,a,{unique:n[r][a]})}},a.onsuccess=function(e){ke.data.idb.list[t]=e.target.result,o()},a.onerror=function(e){console.log("Could not open IDB..."),console.dir(a.error)}}catch(e){console.log("Indexed DB Open Error:",e)}},check_struct:function(e,t){for(var n in this.structs[t])if(!(n in e))return!1;for(var n in e)if(!(n in this.structs[t]))return!1;return!0},add:function(e,t,n,r,o){var a=ke.data.idb.list[e];if(a&&this.structs[r]&&this.check_struct(n,r)){var i=a.transaction([t],d).objectStore(t).add(n);i.onsuccess=function(e){o(e.target.result,n)},i.onerror=function(e){console.log("error add:",n,e)}}else o(null,null),console.error("Db not found or obj_struct_name not defined")},get:function(e,t,n,r){var o=ke.data.idb.list[e];o&&(o.transaction([t],p).objectStore(t).get(n).onsuccess=function(e){r(e.target.result)})},ARITH_ADD_UPDATE_TYPE:1,DEFAULT_UPDATE_TYPE:-1,ADD_FIELD_UPDATE_TYPE:2,update:function(e,t,n,r,o){var a=ke.data.idb.list[e];if(a){var i=a.transaction([t],d).objectStore(t);i.get(n).onsuccess=function(e){var t=e.target.result;for(var a in r)undefined!==t[a]?pl.type(r[a],"obj")&&r[a].update_type&&r[a].update_type!==ke.idb.DEFAULT_UPDATE_TYPE?r[a].update_type===ke.idb.ARITH_ADD_UPDATE_TYPE&&(t[a]+=r[a].value):t[a]=r[a]:r[a].update_type===ke.idb.ADD_FIELD_UPDATE_TYPE&&ke.idb.structs[r[a].struct]&&ke.idb.structs[r[a].struct].hasOwnProperty(a)&&(t[a]=r[a].value);i.put(t,n).onsuccess=function(e){o(t,e.target.result)}}}},findAndDel:function(e,t,n,r,o){ke.idb.search(e,t,n,(function(n){var o=[];n.forEach((function(e){o.push(e.id)})),ke.idb.del(e,t,o,r)}),o)},findAndUpdate:function(e,t,n,r,o,a){ke.idb.search(e,t,n,(function(n){var a=[];n.forEach((function(n){ke.idb.update(e,t,n.id,r,(function(e,t){e.id=t,a.push(e)}))}));var i=setInterval((function(){a.length===n.length&&(clearInterval(i),o(a))}),10)}),a)},del:function(e,t,n,r){if(0!==n.length){var o=ke.data.idb.list[e];if(o){var a=o.transaction([t],d),i=a.objectStore(t);n.forEach((function(e){i.delete(e)})),a.oncomplete=function(e){r(!0)}}}else r(!1)},clear:function(e,t,n){var r=ke.data.idb.list[e];r&&(r.transaction([t],d).objectStore(t).clear().onsuccess=function(e){n()})},enum:function(e,t,n,r,o,a){var i=ke.data.idb.list[e];if(i){var s=i.transaction([t],p),c=s.objectStore(t).openCursor(r,"prev"),u=[];c.onerror=function(e){console.log("cursor error",e)},c.onsuccess=function(e){var t=e.target.result;if(t&&u.length<=n){var r=t.value;r.id=t.primaryKey,u.push(r),t.continue()}},s.oncomplete=function(){o&&u.reverse(),a(u)}}},COMP_OR:1,COMP_AND:2,UPPER_BOUND:1,LOWER_BOUND:2,cache:{},search:function(e,t,n,r,o,a,i,s,c){var u=ke.data.idb.list[e];if(o=o||ke.idb.COMP_OR,i=i||Number.MAX_VALUE,u){ke.idb.cache[e][t]=ke.idb.cache[e][t]||{};var l=JSON.stringify(n),d=[],f=function(n){if(!n&&d.length>150&&(ke.idb.cache[e][t][l]=d),a&&c){var o=[];d.forEach((function(e){(a[0]===ke.idb.UPPER_BOUND&&e[a[1]]<a[2]||a[0]===ke.idb.LOWER_BOUND&&e[a[1]]>a[2])&&o.push(e)})),d=o}c&&d.sort((function(e,t){return e[c]&&t[c]?t[c]-e[c]:0})),s&&d.reverse(),i&&(d=d.slice(0,i)),r(d)};if(ke.idb.cache[e][t][l])d=ke.idb.cache[e][t][l],f(!0);else{var k=u.transaction([t],p);k.objectStore(t).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t){if(pl.type(n,"fn")){if(n(t.value))(r=t.value).id=t.primaryKey,d.push(r)}else{var r,a=!1,i=!0;for(var s in n)pl.type(n[s],"str")&&t.value[s].toLowerCase().indexOf(n[s].toLowerCase())>-1||pl.type(n[s],"int")&&t.value[s]===n[s]||pl.type(n[s],"fn")&&n[s](t.value[s])||pl.type(n[s],"bool")&&t.value[s]===n[s]?a=!0:i=!1;if(o===ke.idb.COMP_AND&&i||o===ke.idb.COMP_OR&&a)(r=t.value).id=t.primaryKey,d.push(r)}t.continue()}},k.oncomplete=function(){f(!1)}}}else r(null,!0)},exists:function(e,t,n,r,o,a){var i=ke.data.idb.list[e];if(i){var s,c=i.transaction([t],p),u=c.objectStore(t);if(2===n.length)s=u.index(n[0]).openCursor(IDBKeyRange.only(n[1]));else s=u.openCursor(null,"prev");s.onsuccess=function(e){var t=e.target.result;if(t){var n=!0;for(var i in r)if(("id"!==i||t.primaryKey!==r[i])&&r[i]!==t.value[i]){n=!1;break}n?(o(!0,t.primaryKey,t.value,a),c.abort()):t.continue()}},c.oncomplete=function(){o(!1,null,null,a)},s.onerror=function(e){o(!1,null,null,a),console.log("exists check error:",e)}}else o(!1,null,null,a)}}),pl.extend(ke.nav,{go:function(e,n){setTimeout((function(){t.location="/pages/public/"+e+".html"}),n||0)}}),ke.getFlag("kumquat_ready")||ke.init(),pl((function(){ke.setFlagTrue("dom_loaded"),ke.init()})),$(window).on("load",(function(){ke.getFlag("kumquat_ready")||ke.init()}))}(this,document);