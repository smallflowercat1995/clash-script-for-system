pl.extend(ke.particles.pro_block.view,{init:function(e){ke.IS_CHROME||$(".stt-feature").remove(),$(".whats-coming-soon").on("click",ke.particles.pro_block.model.onComingSoonClicked),$(".login-button").on("click",ke.particles.pro_block.model.showLogin),$(".signout").on("click",ke.particles.pro_block.model.signOut),$(".pull-sub-data-again").on("click",ke.particles.pro_block.model.retryPullingSubDataAgain),this.setupSurveys(),this.showSyncState(),this.showProState(),"function"==typeof e&&e()},setupSurveys:function(){let e=[ke.ext.util.storageUtil.getVal("account_email"),1,7,ke.ext.util.storageUtil.getVal("user_country"),ke.ext.util.storageUtil.getVal("all_trans_count"),new Date(+ke.ext.util.storageUtil.getVal("install_date"))];$(".survey-layout iframe").each((function(){$(this).attr("src",$(this).attr("src")+";"+e.join(";"))}));let t=[ke.ext.util.storageUtil.isTrueOption("sub_48h_notif"),ke.ext.util.storageUtil.getDecodedVal("sub_data").status];if("trialing"===ke.ext.util.storageUtil.getDecodedVal("sub_data").status){let e=(Date.now()-ke.ext.util.storageUtil.getIntValue("sub_trial_starting_date"))/864e5;t.push(e)}$(".survey-layout.cancelled").attr("src",$(".survey-layout.cancelled").attr("src")+";"+t.join(";")),$(".survey-layout .dismiss").on("click",ke.particles.pro_block.model.dismissSurvey)},tryShowingProSurvey:function(e){"active"===e.status&&0===ke.ext.util.storageUtil.getIntValue("sub_pro_survey")&&Math.random()<.5&&($(".combo-change-window").hide(),$(".combo-change-window.just-subscribed").show(),$(window).scrollTop(0),$("body").addClass("stop-scrolling"),$(".survey-layout").fadeIn(100).css("display","flex"),ke.ext.util.storageUtil.setIntValue("sub_pro_survey",1))},showProState:function(){ke.isLegacyProUser?($(".no-pro-layout").hide(),$(".pro-layout").hide(),$(".no-pro-layout-old").hide(),ke.isSubscriptionBased?($(".pro-block-design").hide(),$(".pro-layout.legacy").show()):($(".pro-layout.old").show(),$(".restore").hide(),$(".student-discount").hide())):ke.particles.pro_block.model.getLatestSubscriptionData(this.showSubscriptionStatus)},showSubscriptionStatus:function(e){let t=ke.ext.util.storageUtil.getDecodedVal("sub_data"),o=ke.ext.util.storageUtil.getDecodedVal("temp_sub_data");console.log("got sub status:",e),console.log(t),ke.particles.pro_block.view.tryShowingProSurvey(t);let i=ke.ext.util.storageUtil.getVal("user_country"),l=ke.isEEA(i)?"eu":i in ke.ext.const.subscriptions.prices.tier_1?i:"default";$(".plan.monthly .price").html(ke.ext.util.storageUtil.getVal("sub_price_monthly")+ke.getLocale("Sub_Month")),$(".plan.annual .price").html(ke.ext.util.storageUtil.getVal("sub_price_annual")+ke.getLocale("Sub_Year"));let s=ke.ext.util.storageUtil.getVal("sub_price_annual").replace(",",".").match(/\d+(,|.)\d+/)[0],a=ke.ext.util.storageUtil.getVal("sub_price_monthly").replace(",",".").match(/\d+(,|.)\d+/)[0],r=Math.floor(100*(1-s/(12*a)));if($(".plan.annual .savings").html(ke.getLocale("Sub_Savings").replace("{{savings}}",r)),$(".price-due").html($(".plan.selected .price").html()),ke.ext.util.storageUtil.isTrueOption("sub_been_subscribed_once")?($(".pro-subscribe").html(ke.getLocale("Sub_SubscribeNow")),$("._48h-notification").remove()):$(".trial-days").html(7),ke.ext.util.storageUtil.isTrueOption("sub_48h_notif")||$("._48h-notification").remove(),$(".plan").on("click",ke.particles.pro_block.model.changeBillingPeriod),$(".pro-subscribe").on("click",ke.particles.pro_block.model.subscribe),$(".screw-subscription").on("click",ke.particles.pro_block.model.screwSubscription),$(".student-discount").on("click",ke.particles.pro_block.model.requestStudentDiscount),ke.ext.util.storageUtil.getVal("account_token")?$(".purchased-pro-before").remove():$(".purchased-pro-before").on("click",ke.particles.pro_block.model.restoreSubscription),ke.ext.util.storageUtil.isTrueOption("already_submitted_screw_sub_survey")&&$(".screw-subscription").remove(),"server_error"===e)$(".pro-layout.with-account").hide(),$(".no-pro-layout").show(),$(".no-pro-layout-old").hide(),$(".pro-data-loading-layout").fadeOut(100),$(".error-layout").css("display","flex");else if("no_account"===e&&o.email)console.log("finish creating your account"),$(".pro-block-design").hide(),$(".no-pro-layout").hide(),$(".pro-layout.with-account").hide(),$(".pro-layout.no-account").show(),$(".no-pro-layout-old").hide(),o.signed_in_before?($(".pro-layout.no-account .next-billing").html(ke.getLocale("Sub_PleaseSignBackIn").replace("{{email}}",o.email)),$(".finish-creating-button").hide(),$(".login-button").show()):($(".pro-layout.no-account .next-billing").html(ke.getLocale("Sub_PleaseCreateAccount").replace("{{email}}",o.email)),$(".login-button").hide(),$(".finish-creating-button").show()),$(".finish-creating-button").on("click",ke.particles.pro_block.model.finishCreatingAccount);else if(t.isSubscriptionVerified){if(t.isSubscriptionVerified){console.log("sub verified"),$(".no-pro-layout").fadeOut(100),$(".pro-block-design").hide(),$(".pro-pitch").hide(),$(".pro-layout.no-account").hide(),$(".no-pro-layout-old").hide(),$(".pro-layout.with-account").show(),$(".sub-email").html(t.email);let e=t.unit_price+" "+t.currency,o=new Date(t.next_bill_date).toString().split(" ").splice(1,3).join(" ");if($(".change-payment-method").attr("href",t.update_url),$(".cancel-subscription").attr("href",t.cancel_url).on("click",ke.particles.pro_block.model.cancelSub),$(".resubscribe").hide(),"trialing"===t.status)$(".next-billing").html(ke.getLocale("Sub_WhenTrialing").replace("{{next_amount_billed}}",e).replace("{{next_billing_date}}",o));else if(t.isCancelled){let e=new Date(t.endsOn).toString().split(" ").splice(1,3).join(" ");$(".next-billing").html(ke.getLocale("Sub_WhenCancelled").replace("{{sub_ends_on}}",e)),$(".change-payment-method").hide(),$(".cancel-subscription").hide(),$(".resubscribe").show().on("click",ke.particles.pro_block.model.resubscribe)}else $(".next-billing").html(ke.getLocale("Sub_NextBilling").replace("{{next_amount_billed}}",e).replace("{{next_billing_date}}",o))}}else if(ke.isSubscriptionBased){const e=1;if(e>=2){const t=ke.ext.const.subscriptions.one_off_prices["tier_"+e][l][0];$(".pro-version-button").html(ke.getLocale("Window_Mw_UpgradeButton",t))}console.log("no sub â€“ upgrade block"),$(".pro-layout").hide(),$(".no-pro-layout").show(),$(".no-pro-layout-old").hide(),$(".pro-data-loading-layout").fadeOut(100)}else{$(".no-pro-layout-old").show(),$(".pro-data-loading-layout").fadeOut(100),$(".error-free-pro-layout").hide();let e=ke.ext.util.storageUtil.getVal("pro_inapp_price");ke.ext.util.storageUtil.getVal("user_country")in ke.ext.const.subscriptions.CUSTOM_CHECKOUT_LINKS&&(e=ke.ext.const.subscriptions.CUSTOM_CHECKOUT_LINKS[ke.ext.util.storageUtil.getVal("user_country")].price),$(".pro-version-button").on("click",ke.particles.pro_block.model.upgrade).html(ke.getLocale("Window_Mw_UpgradeButton",e)),$(".restore").on("click",ke.particles.pro_block.model.restoreSubscription)}},showSyncState:function(){ke.ext.util.storageUtil.chainRequestBackgroundOption([{fn:"getVal",args:["account_token"]},{fn:"isTrueOption",args:["chr_pro_flag"]},{fn:"getVal",args:["account_email"]}],(function(e){var t=e[0].response,o=(e[1].response,e[2].response);t?($(".login-email").html(o),$(".signed-out-layout").hide(),$(".signed-in-layout").show(),$(".sync-block .pro-pitch").hide(),ke.isProUser?$(".sync-option-disabled").hide():$(".sync-option-disabled").show()):($(".signed-in-layout").hide(),$(".signed-out-layout").show(),$(".sync-block .pro-pitch").show())}))}});