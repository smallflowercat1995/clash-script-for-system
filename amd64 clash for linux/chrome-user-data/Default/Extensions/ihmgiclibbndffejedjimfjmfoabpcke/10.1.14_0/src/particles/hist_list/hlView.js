ke.import("ext.googleApi"),pl.extend(ke.particles.hist_list.view,{populateHistoryList:function(e,t,i,l){ke.idb.search("it","history",{pending_removal:!1},(function(t,s){!t&&s||(ke.particles.hist_list.view.toggleEmptyHistoryCap(),t.length>0&&t.forEach((function(e){ke.particles.hist_list.view.drawHistoryItem(e,void 0,i)})),e(l||!1,t.length))}),ke.idb.COMP_AND,t,50,i,"time")},drawHistoryItem:function(e,t,i){if(!~pl.inArray(e.time,ke.app.temp.item_times)){ke.app.temp.item_times[i?"unshift":"push"](e.time);var l=e.input,s=e.it_resp,a=ke.ext.googleApi.parseReceivedTranslation(s,!0,"",!1),r=a[0]?"":" collapsed",o=ke.ext.time.beautify(e.time);a[2]=a[2]||"",a[0]||(a[2]=""),pl.type(t,"undef")||(l=ke.ext.string.highlight(l,t),a[1]=ke.ext.string.highlight(a[1],t));var n="";if(e.sources){var p=e.sources;for(var g in p)n+='<div class="source-item"><div class="source">'+("popup"===g?ke.getLocale("History_InPopup"):"adev"===g?ke.getLocale("History_AnotherDevice"):'<a class="source-link" href="'+g+'" target="_blank">'+decodeURI(g)+"</a>")+'</div><div class="time-small">'+ke.ext.time.beautify(p[g])+"</div></div>"}else n='<div class="time">'+o+"</div>";pl(".history-list")[i?"prepend":"append"](ke.ext.tpl.compile(ke.templates.historyListItem,{id:e.id,input:l,main_output:a[1],collapse_variants:r,variants:ke.ext.tpl.compile(a[2],{from:e.l_from,to:e.l_to}),sliding_wrap_visibility:ke.app.flags.isTickerWrapActive?"":"invisible-sw",listen_wrap_visibility:-1===pl.inArray(e.id,ke.app.temp.expanded)?"invisible-sw":"",selected:~pl.inArray(e.id,ke.app.temp.selected)?"active-st":"",from_lang:e.l_from,to_lang:e.l_to,translit_original:ke.ext.googleApi.getSourceTranslitFromJson(s),translit_translation:ke.ext.googleApi.getTargetTranslitFromJson(s),gender_original:s[8]?s[8]:"",gender_translation:s[9]?s[9]:"",time:o,sources:n,lang_from:ke.getLocale("Kernel_Lang_"+ke.ext.util.langUtil.getLangNameByKey(e.l_from)),lang_to:ke.getLocale("Kernel_Lang_"+ke.ext.util.langUtil.getLangNameByKey(e.l_to))}))}},toggleEmptyHistoryCap:function(){return ke.particles.hist_list.model.toggleListEndCap("History_Content_List_OnEmpty")}});