!function(e){pl.extend(ke.app.handlers,{passInlineTranslation:0,scanForProperCombination:function(e,t,a){return chrome.runtime.sendMessage({action:ke.processCall("app","option","getKeyComboOptionActiveness"),identificator:"tooltip",dblclick:a},(function(e){e.is_active&&chrome.runtime.sendMessage({action:ke.processCall("app","option","isKeyCombo"),identificator:"tooltip",keys_down:ke.ext.event.keysDown,dblclick:e.old_data.dblclick},(function(e){(e.old_data.dblclick||e.is_active)&&(t(e.combo,e.from,e.to,e.old_data.event),ke.ext.event.keysDown={})}))})),!0},hasFocusedInputs:function(e){e=e||document;var t=!1;return $(e.body).find("*:focus").each((function(){($(this).is("input,textarea")||"true"==this.contentEditable)&&(t=!0)})),t},skipSelectTranslation:!1,onDoubleClick:function(t,a,n){(t.target.className||"").indexOf(ke.getPrefix())>-1||chrome.runtime.sendMessage({action:ke.processCall("app","option","getDoubleClickOptionActiveness"),event:ke.ext.event.getNecessaryInfo(t),identificator:"tooltip"},(function(t){!t.is_active||ke.app.handlers.hasFocusedInputs(a)||pl.empty(ke.particles.translate_ctt.model.getSelectedText())||(ke.app.handlers.skipSelectTranslation=!0,chrome.runtime.sendMessage({action:ke.processCall("app","option","getMainLanguagePair"),identificator:"tooltip"},(function(t){ke.app.handlers.hasFocusedInputs(a)||pl.empty(ke.particles.translate_ctt.model.getSelectedText())||(ke.app.handlers.lastTranslationCallArgs.doc=a,ke.app.handlers.lastTranslationCallArgs.iframe=n,ke.particles.translate_ctt.model.showTranslation(e,t.from_lang,t.to_lang,a,n,"double-click"))})))}))},hideSelectionButton:function(){$("."+ke.getPrefix()+"translate-selection-button").fadeOut(150,(function(){$(this).remove()}))},onSelection:function(e,t,a){pl.empty(ke.particles.translate_ctt.model.getSelectedText())||("string"==typeof e.target.className?e.target.className:"").indexOf(ke.getPrefix())>-1&&-1===("string"==typeof e.target.className?e.target.className:"").indexOf("mate-subtitle-wrap")?ke.app.handlers.hideSelectionButton():chrome.runtime.sendMessage({action:ke.processCall("app","option","getTranslateOnSelectActiveness"),event:ke.ext.event.getNecessaryInfo(e),identificator:"tooltip"},(function(e){!e.is_active||ke.app.handlers.hasFocusedInputs(t)||pl.empty(ke.particles.translate_ctt.model.getSelectedText())||chrome.runtime.sendMessage({action:ke.processCall("app","option","getMainLanguagePair"),identificator:"tooltip"},(function(e){if(!ke.app.handlers.hasFocusedInputs(t)&&!pl.empty(ke.particles.translate_ctt.model.getSelectedText()))if(ke.app.handlers.skipSelectTranslation)ke.app.handlers.skipSelectTranslation=!1;else{var a=ke.particles.translate_ctt.model.getSelection(),n=ke.ui.tooltip.helpSelected._getSelectionParameters(a);if(ke.app.handlers.lastTranslationCallArgs.text=a.toString(),ke.app.handlers.lastTranslationCallArgs.selectionBB=n,$("."+ke.getPrefix()+"translate-selection-button").remove(),document.location.href.indexOf("netflix.com/watch")>-1)ke.app.handlers.netflix.pause(),ke.app.handlers.translateSelection(null,e.from_lang,e.to_lang);else{var s,l=n.left+n.width/2+window.pageXOffset-12;s=n.top+n.height+10+24>window.innerHeight?n.top-10-24+window.pageYOffset:n.top+n.height+10+window.pageYOffset,$("body").append($('<div class="'+ke.getPrefix()+'translate-selection-button"></div>').css({top:s,left:l}).data("l-from",e.from_lang).data("l-to",e.to_lang).on("click",ke.app.handlers.translateSelection)),setTimeout((function(){$("."+ke.getPrefix()+"translate-selection-button").fadeOut(250,(function(){$(this).remove()}))}),2e3)}}}))}))},upgradeForArticle:function(){let e="";ke.isSubscriptionBased&&(e="annual,"),chrome.runtime.sendMessage({action:ke.processCall("app","opt","newTab"),url:chrome.extension.getURL("/pages/public/options.html#start_purchase,"+e+"articles")}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"upgrade-for-articles"})},upgradeForIpa:function(){let e="";ke.isSubscriptionBased&&(e="annual,"),chrome.runtime.sendMessage({action:ke.processCall("app","opt","newTab"),url:chrome.extension.getURL("/pages/public/options.html#start_purchase,"+e+"ipa-translit")}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"upgrade-for-ipa"})},translateSelection:function(t,a,n){t&&(t.stopPropagation(),t.preventDefault());var s=a||$(this).data("l-from"),l=n||$(this).data("l-to");ke.particles.translate_ctt.model.showTranslation(e,s,l,null,null,"selection")},lastTranslationCallArgs:{from:null,to:null,text:null,doc:e,iframe:e,selection:null,selectionBB:null},onKeyCombinationClick:function(t,a,n){return ke.ext.event.isDown("esc",ke.ext.event.IN_STR)?(ke.ui.tooltip.simple.close(!0),void $(".TnITTtw-translate-loading").remove()):ke.app.handlers.hasFocusedInputs(a)?void 0:ke.app.handlers.scanForProperCombination(t,(function(t,s,l){if(ke.app.handlers.passInlineTranslation)return--ke.app.handlers.passInlineTranslation;ke.particles.translate_ctt.model.getSelectedText(a)&&(ke.app.handlers.lastTranslationCallArgs.doc=a,ke.app.handlers.lastTranslationCallArgs.iframe=n,ke.particles.translate_ctt.model.showTranslation(e,s,l,a,n,"shortcut"))}),!1)},getListenValue:function(e,t){var a=t.target?$(ke.ext.util.selectorsUtil.getTooltipWrapRecursively(t.target)):t;return"orig"===e?ke.ext.string.removeHtml(a.find("."+ke.getPrefix()+"original-wrap ."+ke.getPrefix()+"mv-text-part").html())||ke.ext.string.removeHtml(a.find("."+ke.getPrefix()+"original-wrap ."+ke.getPrefix()+"tpart").html()):"trans"===e?ke.ext.string.removeHtml(a.find("."+ke.getPrefix()+"main-variant ."+ke.getPrefix()+"mv-text-part").html())||ke.ext.string.removeHtml(a.find("."+ke.getPrefix()+"trans-wrap ."+ke.getPrefix()+"tpart").html()):""},reverseTranslation:function(e){null!=ke.app.handlers.lastTranslationCallArgs.from&&null!=ke.app.handlers.lastTranslationCallArgs.to&&null!=ke.app.handlers.lastTranslationCallArgs.text&&(ke.particles.translate_ctt.model.showTranslation(null,ke.app.handlers.lastTranslationCallArgs.to,ke.app.handlers.lastTranslationCallArgs.from,ke.app.handlers.lastTranslationCallArgs.doc,ke.app.handlers.lastTranslationCallArgs.iframe,"reverse"),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"reverse-translate"}))},highlight:function(e){$("body").highlight(ke.app.handlers.getListenValue("orig",e),{wordsOnly:!0}),setTimeout((function(){$("body").unhighlight()}),750),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"highlight"})},unpin:function(e){ke.ext.util.storageUtil.requestProStatus((t=>{if(t){var a=$(ke.ext.util.selectorsUtil.getTooltipWrapRecursively(e.target));a.addClass(ke.getPrefix()+"unpinned"),a.find("."+ke.getPrefix()+"help-selected-wrap").removeClass(ke.getPrefix()+"with-netflix-buttons"),a.find("."+ke.getPrefix()+"help-selected-wrap").removeClass(ke.getPrefix()+"with-info-warn"),a.find("."+ke.getPrefix()+"arr0w").remove();a.find("."+ke.getPrefix()+"utils").slideUp(175,"easeInOutQuint"),setTimeout((function(){a.find("."+ke.getPrefix()+"unpinned-utils").css("display","block"),a.find("."+ke.getPrefix()+"original-wrap").slideDown(175,"easeInOutQuint",(function(){var e=a.data("ttid");$(this).css("display","block"),ke.particles.scrollbars.model.setupHelpSelectedScroll(e)}))}),100);var n=0,s=0,l=function(e){a.css({left:e.clientX-n,top:e.clientY-s})};a.find("."+ke.getPrefix()+"unpinned-utils").on("mousedown",(function(e){1===e.which&&(n=e.clientX-parseInt(a.css("left")),s=e.clientY-parseInt(a.css("top")),$(window).on("mousemove",l))})),$(window).on("mouseup",(function(){$(window).off("mousemove",l)})),$("."+ke.getPrefix()+"close-unpinned").on("click",(function(e){$(ke.ext.util.selectorsUtil.getTooltipWrapRecursively(e.target)).fadeOut(125,"easeInOutQuint",(function(){$(this).remove()}))})),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"unpin"})}else{let e="";ke.isSubscriptionBased&&(e="annual,"),chrome.runtime.sendMessage({action:ke.processCall("app","opt","newTab"),url:chrome.extension.getURL("/pages/public/options.html#start_purchase,"+e+"tooltip-unpin")}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"upgrade-to-pro-unpin"})}}))},settings:function(){chrome.runtime.sendMessage({action:ke.processCall("app","opt","newTab"),url:chrome.extension.getURL("/pages/public/options.html#3,tooltip")}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"settings"}),ke.ext.util.storageUtil.requestBackgroundOption("setVal",["new_settings_counter",10])},useLocalizedInfoWarn:function(){chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"use-sw-warn"})},closeInlineOption:function(e){e.stopPropagation();var t=+$(this).data("ttid"),a=$(this).parent().data("option");$(this).parent().slideUp(125,"easeInOutQuint",(function(){$(this).remove(),$("."+ke.getPrefix()+"hsw-"+t).removeClass(ke.getPrefix()+"with-info-warn"),ke.particles.scrollbars.model.setupHelpSelectedScroll(t,0)})),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"inline-option-close",subevent:a})},disableInlineOption:function(){var e=$(this).data("option");chrome.runtime.sendMessage({action:ke.processCall("app","option","disableOption"),option:e}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"inline-option-disable",subevent:e}),$(this).addClass(ke.getPrefix()+"disabled").find("span").html(ke.getLocale("Tooltip_InlineOptionDisabled"))},zendesk_observer:null,checkZendeskTickets:function(){ke.app.handlers.zendesk_observer=new MutationObserver((function(e){/zendesk.com\/agent\/tickets\/([0-9]+)/.test(document.location.href)&&(ke.ext.util.storageUtil.requestBackgroundOption("setVal",["zendesk_user",!0]),ke.app.handlers.zendesk_observer&&ke.app.handlers.zendesk_observer.disconnect())})),ke.app.handlers.zendesk_observer.observe(document.querySelector("body"),{childList:!0,subtree:!0})},onPageLangDropdownValueChanged:(e,t)=>{3===e?ke.particles.lang_selectors.model.onFullPageLangDropdownChange(e,t,null,!1,(()=>{onFPLangSelectorValueChanged(e,t)})):ke.particles.lang_selectors.model.onLangDropdownChange(e,t,null,!1,(()=>{1===e?ke.particles.translate_ctt.model.showTranslation(null,t,ke.app.handlers.lastTranslationCallArgs.to,ke.app.handlers.lastTranslationCallArgs.doc,ke.app.handlers.lastTranslationCallArgs.iframe,"lang-changed"):2===e&&ke.particles.translate_ctt.model.showTranslation(null,ke.app.handlers.lastTranslationCallArgs.from,t,ke.app.handlers.lastTranslationCallArgs.doc,ke.app.handlers.lastTranslationCallArgs.iframe,"lang-changed")}))},onPageLangDropdownOpened:(e,t)=>{3===e?ke.particles.scrollbars.model.setupFPDropdownScroll(t):ke.particles.lang_selectors.model.onOpen(e,t)},netflix:{prevSubtitles:"",handleNavigation:function(){var e=function(){clearInterval(ke.app.temp.subtitle_update_int),ke.app.temp.wordlist_id=null,ke.app.flags.netflix_player_loaded=!1,ke.app.temp.landing_href=document.location.href};document.location.href!==ke.app.temp.landing_href&&document.location.href.indexOf("https://www.netflix.com/watch/")>-1?(e(),ke.app.temp.landing_href=document.location.href,ke.app.initNetflixSubtitleTranslator()):ke.app.temp.landing_href.indexOf("https://www.netflix.com/watch/")>-1&&-1===document.location.href.indexOf("https://www.netflix.com/watch/")&&e()},parseAndShowSubtitle:function(e){var t="";if(e.each((function(){t+=" "+$(this).text()})),t=t.replace(/  /g," "),e.hide(),ke.app.handlers.netflix.prevSubtitles===t)return ke.app.temp.bottom_controls_height=$(".watch-video--bottom-controls-container").css("height"),void $("."+ke.getPrefix()+"mate-subtitle-wrap").css("bottom",parseInt(ke.app.temp.bottom_controls_height)+16);ke.app.handlers.netflix.prevSubtitles=t,ke.app.handlers.netflix.showClickableSubtitle(t)},play:function(){$('div[data-uia="player"]').hasClass("inactive")&&$('div[data-uia="player"]').trigger("click"),$('button[data-uia="control-play-pause-play"]').trigger("click")},pause:function(){$('div[data-uia="player"]').hasClass("inactive")&&$('div[data-uia="player"]').trigger("click"),$('button[data-uia="control-play-pause-pause"]').trigger("click")},getEpisodeName:function(){var e=ke.app.temp.netflix_episode_name&&" – "+ke.app.temp.netflix_episode_name||"",t=ke.app.temp.netflix_episode_code?" ("+ke.app.temp.netflix_episode_code+")":"";return ke.app.temp.netflix_title+e+t},save:function(e){var t=$(this);ke.ext.util.storageUtil.requestProStatus((a=>{if(a)chrome.runtime.sendMessage({action:ke.processCall("app","phrasebook","addPhrase"),wl_name:ke.app.handlers.netflix.getEpisodeName(),phrase:ke.particles.three_dots.model.getOriginalWord(e),from:ke.app.temp.netflix_subtitles_lang,to:ke.app.temp.to_lang,usageExample:ke.app.handlers.netflix.capturedSubtitle},(function(e){ke.app.temp.wordlist_id=e.parent_wordlist_key,t.addClass(ke.getPrefix()+"netflix-saved-state").html("SAVED!"),ke.app.handlers.netflix.play(),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"pb",event:"phrase-add",subevent:"from-netflix"}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"netflix",subevent:"save"})}));else{let e="";ke.isSubscriptionBased&&(e="annual,"),chrome.runtime.sendMessage({action:ke.processCall("app","opt","newTab"),url:chrome.extension.getURL("/pages/public/options.html#start_purchase,"+e+"netflix-phrasebook-saving")}),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"netflix",subevent:"upgrade-for-saving-to-pb"})}}))},continue:function(){ke.ui.tooltip.simple.close(!0),ke.app.handlers.netflix.play(),chrome.runtime.sendMessage({action:ke.processCall("app","commands","sendAnalyticsEvent"),cat:"tooltip",event:"netflix",subevent:"continue"})},fetchWordlistId:function(){chrome.runtime.sendMessage({action:ke.processCall("app","phrasebook","getWordlistIdByName"),wl_name:ke.app.handlers.netflix.getEpisodeName(),from:ke.app.temp.netflix_subtitles_lang,to:ke.app.temp.to_lang},(function(e){ke.app.temp.wordlist_id=e}))},viewSavedWords:function(){ke.app.temp.wordlist_id&&chrome.runtime.sendMessage({action:ke.processCall("app","opt","newTab"),url:chrome.extension.getURL("/pages/public/phrasebook.html#wl-"+ke.app.temp.wordlist_id)})},setNewParsedSubtitleLang:function(e){e=e.replace(/ \[.*\]/,"");var t,a=document.querySelector("html").getAttribute("lang").split("-").shift(),n=ke.ext.const.netflix_langs[a]||ke.ext.const.netflix_langs.en,s=e.split(" ");s.length>1?(s.push(e),s.forEach((function(e){var a=n[ke.ext.string.getTitleCase(e)];a&&"auto"!==a&&(t=a)})),ke.app.temp.netflix_subtitles_lang=t||"auto"):ke.app.temp.netflix_subtitles_lang=n[ke.ext.string.getTitleCase(s[0])]||"auto"},onSubtitlesLangChange:function(){var e=$(this),t=setInterval((function(){var a=e.next().find(".track-list-subtitles .track");a.length>0&&(clearInterval(t),a.on("click",(function(){var e=$(this).text();setTimeout((function(){ke.app.handlers.netflix.setNewParsedSubtitleLang(e),ke.app.handlers.netflix.fetchWordlistId()}),250)})))}),250)},showClickableSubtitle:function(e){if(ke.ui.tooltip.simple.close(!0),$("."+ke.getPrefix()+"mate-subtitle-wrap").fadeOut(150,(function(){$(this).remove()})),e){var t=e.replace(/&nbsp;/g," ").replace(ke.ext.string.hackRegex(/((?!br\b)\b(\p{L}|\')+)/g),'<span class="'+ke.getPrefix()+'clickable-mate-subtitle">$1</span>');$("<div>").addClass(ke.getPrefix()+"mate-subtitle-wrap").css("font-size",ke.app.temp.netflix_subtitles_fontsize).css("bottom",(parseInt(ke.app.temp.bottom_controls_height)||0)+16).html(t).appendTo(".watch-video--player-view").find("."+ke.getPrefix()+"clickable-mate-subtitle").on("click",ke.app.handlers.netflix.translate)}},translate:function(){ke.app.handlers.netflix.capturedSubtitle=ke.app.handlers.netflix.prevSubtitles.replace(/<br>/g," ").replace(/&nbsp;/g," ");var t=$(this).html();ke.app.handlers.netflix.pause();var a=ke.ext.dom.getPosition(this),n=$(this).width(),s=$(this).height();chrome.runtime.sendMessage({action:ke.processCall("app","option","getMainLanguagePair"),identificator:"tooltip"},(function(l){ke.app.handlers.lastTranslationCallArgs.doc=null,ke.app.handlers.lastTranslationCallArgs.iframe=null,ke.app.handlers.lastTranslationCallArgs.text=t,ke.app.handlers.lastTranslationCallArgs.selectionBB={left:a[0],top:a[1],width:n,height:s},ke.app.temp.to_lang=l.to_lang,ke.particles.translate_ctt.model.showTranslation(e,ke.app.temp.netflix_subtitles_lang,l.to_lang,null,null,"netf")}))}},_processEventHandlers:{app:{audio:{},trans:{getSelectedText:function(e,t){t(ke.particles.translate_ctt.model.getSelectedText())},displayAsTooltip:function(e,t){if(pl.empty(ke.app.temp.windows))ke.particles.translate_ctt.model.showTranslation(e.message,e.from,e.to,null,null,"context-menu");else try{pl.each(ke.app.temp.windows,(function(t,a){a&&a.getSelection()&&a.getSelection().toString()&&ke.particles.translate_ctt.model.showTranslation(e.message,e.from,e.to,ke.app.temp.windows[t],ke.app.temp.iframes[t],"context-menu")}))}catch(e){}},fullPage:function(e,t){tryShowingMateBar(!0)}}}}})}();