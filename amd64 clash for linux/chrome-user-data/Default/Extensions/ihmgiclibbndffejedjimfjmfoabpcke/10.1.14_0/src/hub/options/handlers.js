pl.extend(ke.app.handlers,{onLabelClick:function(e){var t=$(this).data("option");ke.ui.checkbox.externalElementClicked(ke.getSelectorConst("settings",t[0].toUpperCase()+"_CHECK"))},beforeUnload:function(e){ke.ext.util.storageUtil.requestBackgroundOption("getDecodedVal",["add_trans_combinations"],(function(e){for(var t in e)"main"==t||!pl.empty(t)&&!pl.empty(e[t])&&e[t].from&&e[t].to||ke.ext.util.storageUtil.requestBackgroundOption("deleteJsonElementByKey",["add_trans_combinations",t])}))},handleMessagesFromIFrames:function(e){if("https://gikken.co"===e.origin)if(e.data.indexOf("height")>-1){let t=Math.ceil(parseFloat(e.data.split("=").pop()));t>0&&$(".survey-layout .popup:visible iframe").css("height",t+"px")}else"get_dark_mode"===e.data?ke.ext.util.storageUtil.requestBackgroundOption("isTrueOption",["dark_mode"],(function(t){e.source.postMessage("dark_mode="+t,e.origin)})):"finished"===e.data&&(setTimeout((()=>{let e=$(".combo-change-window:visible").hasClass("cancelled");ke.particles.pro_block.model.dismissSurvey(),e&&(document.location.href=$(".cancel-subscription").attr("href"))}),3e3),ke.ext.util.storageUtil.setVal("already_submitted_screw_sub_survey",!0))},showSharingWindow:function(e){var t=$(this).data("pl");"email"===t?chrome.runtime.sendMessage({action:ke.processCall("app","opt","shareViaEmail")}):window.open(ke.ext.tpl.compile(ke.share_links[t],{link:encodeURIComponent(ke.storeLink),text:encodeURIComponent(ke.getLocale("Settings_ShareText").replace("{{platform}}",ke.browserName))}),"Share Mate Translate","fullscreen=no,width=520,height=480"),"undefined"!=typeof ga&&ga("send","event","options","feedback","share-"+t)},copyLink:function(){$(this)[0].select(),ke.ext.clipboard.copyToClipboard(ke.storeLink),ke.ui.notifications.show(ke.getLocale("Common_Copied"),2500),"undefined"!=typeof ga&&ga("send","event","options","feedback","link-copied")},handleLoginStateChange:function(e){var t=ke.parseProcessCall(e.action);"app"===t.lib&&"login"===t.cmd&&"done"===t.exact?(ke.particles.pro_block.view.showSyncState(),ke.particles.pro_block.view.showProState()):"app"===t.lib&&"pro"===t.cmd&&"finish-checkout"===t.exact&&ke.particles.pro_block.model.finishCheckoutCallback(e.email)},openPhrasebook:function(){chrome.tabs.create({url:chrome.extension.getURL("/pages/public/phrasebook.html")})},onSubscribe:function(){chrome.tabs.create({url:"http://eepurl.com/drXl6T"}),"undefined"!=typeof ga&&ga("send","event","options","feedback","subscribe")},onEmailUs:function(){chrome.runtime.sendMessage({action:ke.processCall("app","opt","sendEmail")}),"undefined"!=typeof ga&&ga("send","event","options","feedback","email")},onHC:function(){chrome.runtime.sendMessage({action:ke.processCall("app","opt","openHC")}),"undefined"!=typeof ga&&ga("send","event","options","feedback","help-center")},showOtherApps:function(){chrome.runtime.sendMessage({action:ke.processCall("app","opt","showOtherApps")}),"undefined"!=typeof ga&&ga("send","event","options","feedback","show-other-apps")},onFacebookOpen:function(){chrome.tabs.create({url:"https://facebook.com/MateTranslate"}),"undefined"!=typeof ga&&ga("send","event","options","feedback","facebook")},onTwitterOpen:function(){chrome.tabs.create({url:"https://twitter.com/MateTranslate"}),"undefined"!=typeof ga&&ga("send","event","options","feedback","twitter")},onSiteOpen:function(){chrome.tabs.create({url:"https://gikken.co/mate-translate/?ref="+ke.browserName+"Settings"}),"undefined"!=typeof ga&&ga("send","event","options","feedback","site")},saveTooltipSize:function(){if(ke.isProUser){var e=+$(this).data("scale");$(".sel-tt").removeClass("sel-tt"),$(this).addClass("sel-tt"),ke.ext.util.storageUtil.requestBackgroundOption("setVal",["tooltip_scale",e]),"undefined"!=typeof ga&&ga("send","event","options","set-tooltip-size",""+e)}else ke.ui.pro_alert.show(ke.getLocale("Options_TooltipSizePro"),"toolbar-unpin"),"undefined"!=typeof ga&&ga("send","event","window","unpin","need-to-upgrade")},onShortcutSwap:function(){ke.ext.util.storageUtil.requestBackgroundOption("getIntValue",["win_trans_type"],(function(e){ke.ext.util.storageUtil.requestBackgroundOption("setIntValue",["win_trans_type",3-e],(function(){ke.app.render.organize.showPopupShortcuts()}))})),"undefined"!=typeof ga&&ga("send","event","options","shortcuts","change-window-shortcut")},openPrivacyPolicy:function(){chrome.tabs.create({url:"https://gikken.co/mate-translate/privacy/?ref="+ke.browserName})},openToS:function(){chrome.tabs.create({url:"https://www.matetranslate.com/terms-of-use"})},revokeConsent:function(){ke.ext.util.storageUtil.requestBackgroundOption("setVal",["gdpr_consent",!1]),alert("Okay!"),ke.ext.util.storageUtil.requestBackgroundOption("getVal",["account_token"],(function(e){$.ajax({url:"https://sync.matetranslate.com/accept_gdpr",type:"GET",dataType:"json",data:{token:e,accept:!1},success:function(e){},error:function(){}})})),"undefined"!=typeof ga&&ga("send","event","gdpr","revoke")},eraseUserData:function(){var e=confirm(ke.getLocale("Settings_EraseConfirm"));"undefined"!=typeof ga&&ga("send","event","gdpr","erase"),e&&ke.ext.util.storageUtil.requestBackgroundOption("getVal",["account_token"],(function(e){$.ajax({url:"https://sync.matetranslate.com/erase_all_user_data",type:"GET",dataType:"json",data:{token:e},success:function(e){e.success?(alert(ke.getLocale("Settings_DataErased")),ke.ext.util.storageUtil.chainRequestBackgroundOption([{fn:"setVal",args:["account_email",""]},{fn:"setVal",args:["account_token",""]},{fn:"setVal",args:["account_name",""]}]),ke.particles.pro_block.view.showProState(),ke.particles.pro_block.view.showSyncState(),"undefined"!=typeof ga&&ga("send","event","gdpr","erase-successful")):(alert(e.reason),"undefined"!=typeof ga&&ga("send","event","gdpr","erase-failed"))},error:function(){alert(ke.getLocale("Settings_DataEraseError")),"undefined"!=typeof ga&&ga("send","event","gdpr","erase-failed-ajax")}})}))}});