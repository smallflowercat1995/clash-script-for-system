pl.extend(ke.app,{import:["ext.const.lang","ext.const.storage","ext.util.langUtil","ext.util.storageUtil","ext.compatibility.db","ext.compatibility.storage","ext.mate_events","ext.googleApi","ext.cache","ext.audio","ext.orphography","ext.const.subscriptions","ext.event","ext.tpl","ext.money","ext.string","lib.ping","lib.fingerprint","particles.context.ctxModel","particles.sync.syncModel","particles.pro_block.proModel","bg_events.translate","bg_events.audio","bg_events.option","bg_events.opt","bg_events.commands","bg_events.sync","bg_events.phrasebook","particles.lang_selectors.lsView","ui_components.login"],temp:{menus:{},fullpage_menu:null,subscriptions_test:null},callbacksInitialization:{},flags:{newlyInstalled:!1},country:"com",tts_link:"http://translate.google.com/translate_tts?ie=UTF-8&q={{text}}&tl={{lang}}&total={{textparts}}&idx=0&textlen={{textlen}}&client=dict-chrome-ex&prev=input&ttsspeed={{dictation_speed}}",translation_link:"",getCountry:function(){return this.country},init:function(){if(ke.ext.util.storageUtil.isEmpty("user_id")){var e=ke.generateUserId(5,4);ke.ext.util.storageUtil.setVal("user_id",e),ke.IS_FIREFOX||FingerprintJS.load().then((e=>{e.get().then((e=>{const{fontPreferences:t,plugins:n,screenFrame:a,...i}=e.components,l=FingerprintJS.hashComponents(i);ke.ext.util.storageUtil.setVal("analytics_client_id",l)}))}))}var t=chrome.runtime.getManifest().version;ke.IS_SAFARI||ke.IS_EDGE||chrome.runtime.onUpdateAvailable.addListener(chrome.runtime.reload),ke.supportsOnlineAnalytics?ke.loadExternalScript(ke.analyticsScriptLink,(()=>{ke.initAnalytics(ke.app.handlers.checkIfMetaMaskUser)})):ke.import("lib.ga",(()=>{ke.initAnalytics(ke.app.handlers.checkIfMetaMaskUser)})),chrome.runtime.onMessage.addListener(ke.app.handlers.onCommandReceived),ke.ext.util.storageUtil.initStorage((function(){ke.app.handlers.generateDropdownHtml(),ke.ext.util.storageUtil.getVal("ext_ver")?ke.ext.util.storageUtil.setVal("install_event",!0):ke.ext.util.storageUtil.setVal("new_settings_counter",10),ke.ext.util.storageUtil.setVal("ext_ver",t),ke.app.initContextMenu(),ke.app.initFullpageContextMenu(),ke.app.handlers.checkSponsorships(),ke.app.handlers.submitTranslationCounters(),ke.app.initPreviouslyOpenedTabs(),ke.app.handlers.detectCountry((function(){ke.app.handlers.getProPrice((function(){ke.ext.compatibility.storage.isNewUser()&&(chrome.tabs.create({url:chrome.extension.getURL("/pages/public/tour.html")}),ke.ext.mate_events.send("install"),ke.ext.util.storageUtil.setVal("seen_tour",!0))}))})),ke.app.handlers.pickFastestMateServer(),ke.app.handlers.sendInstallEvent(),ke.app.handlers._processEventHandlers.app.translate.resetMonthlyCounter(),ke.app.handlers._processEventHandlers.app.opt.updateUninstallUri()})),ke.app.handlers.runSync(),chrome.tabs.onUpdated.addListener(ke.app.handlers.checkInternalPagesRedirectSafari)},initContextMenu:function(){for(var e in this.temp.menus)chrome.contextMenus.remove(e),delete this.temp.menus[e];if(ke.ext.util.storageUtil.isTrueOption("ctx_menu")){var t=this,n=function(e,n,a){var i=ke.getLocale("Kernel_Lang_"+ke.ext.util.langUtil.getLangNameByKey(n))+" "+ke.getLocale("Kernel_Context_Into")+" "+ke.ext.orphography.declineTransTo(a),l=chrome.contextMenus.create({id:ke.extId+1e3*Math.random(),title:i,contexts:["selection"],onclick:ke.particles.context.model.onMenuClick});t.temp.menus[l]={combo:e,from:n,to:a}},a=ke.ext.util.storageUtil.getDecodedVal("add_trans_combinations");for(var i in n("main",ke.ext.util.langUtil.getFromLang(),ke.ext.util.langUtil.getToLang()),a)pl.empty(a[i].from)||pl.empty(a[i].to)||n(i,a[i].from,a[i].to)}},initFullpageContextMenu:function(){this.temp.fullpage_menu&&(chrome.contextMenus.remove(this.temp.fullpage_menu),this.temp.fullpage_menu=null),this.temp.fullpage_menu=chrome.contextMenus.create({id:ke.extId+1e3*Math.random(),contexts:["all"],title:ke.getLocale("FullPage_ContextMenuOption"),onclick:ke.app.handlers.loadMateFP})},initPreviouslyOpenedTabs:function(){if(!ke.IS_SAFARI){var e=function(e){for(var t=chrome.runtime.getManifest().content_scripts[0],n=t.js,a=0,i=n.length;a<i;a++)chrome.tabs.executeScript(e.id,{file:n[a]});var l=t.css;for(a=0,i=l.length;a<i;a++)chrome.tabs.insertCSS(e.id,{file:l[a]})};chrome.windows.getAll({populate:!0},(function(t){for(let n=0,a=t.length;n<a;n++){let a=t[n];for(let t=0,n=a.tabs.length;t<n;t++){let n=a.tabs[t],i="boolean"==typeof n.discarded&&n.discarded;n.url.match(/chrome(-extension)?:\/\//gi)||n.url.match(/edge:\/\//gi)||n.url.match(/ms-browser-extension:\/\//gi)||n.url.match(/moz-extension:\/\//gi)||i||e(n)}}}))}}});