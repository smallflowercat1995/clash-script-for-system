pl.extend(ke.app.handlers._processEventHandlers.app.phrasebook,{getWordlistsByLang:function(e,n){ke.idb.search("it","wordlists",{pending_removal:!1,from:e.from,to:e.to},(function(e){n(e)}),ke.idb.COMP_AND)},getWordlistIdByName:function(e,n){ke.idb.search("it","wordlists",{pending_removal:!1,name:e.wl_name,from:e.from,to:e.to},(function(e){e.length>0?n(e[0].id):n(null)}),ke.idb.COMP_AND)},addPhrase:function(e,n){ke.app.handlers._processEventHandlers.app.translate.get({identificator:"phrasebook",dontSaveInCache:!0,text:e.phrase,from:e.from,to:e.to},(function(t){if(t.no_results)n({no_results:!0});else{var o=function(o){e.wl_id||(e.wl_id=o),ke.idb.add("it","phrases",{parent_wordlist_key:e.wl_id,text:e.phrase,translation:t.json[3],json:t.json,added:Date.now(),server_id:null,pending_removal:!1,usageExample:e.usageExample||""},"phrase",(function(o,a){var r=Date.now();ke.idb.update("it","wordlists",e.wl_id,{phrases_count:{update_type:ke.idb.ARITH_ADD_UPDATE_TYPE,value:1},last_update:r},(function(r,d){r.server_id&&ke.app.handlers._processEventHandlers.app.sync.uploadWord({id:o,wl_id:d,wl_server_id:r.server_id,word:a},(function(){})),n({id:o,parent_wordlist_key:e.wl_id,text:e.phrase,translation:t.json[3],json:t.json})}))}))};!e.wl_id&&e.wl_name?("auto"===e.from&&(e.from=t.detected_lang),ke.idb.search("it","wordlists",{pending_removal:!1,name:e.wl_name,from:e.from,to:e.to},(function(n){if(n.length>0)o(n[0].id);else{var t=Date.now();ke.idb.add("it","wordlists",{from:e.from,to:e.to,name:e.wl_name,last_update:t,created:t,phrases_count:0,server_id:null,pending_removal:!1},"wordlist",(function(e,n){o(e)}))}}),ke.idb.COMP_AND)):o()}}))}});